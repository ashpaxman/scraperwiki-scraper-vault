<html>
<head>
  <script src="http://maps.google.com/maps/api/js?sensor=false"></script>
  <script src="http://media.scraperwiki.com/js/jquery-1.3.2.js"></script>
      <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>

</head>
<body>

<h2>Isle of Man Job Centre</h2>

<div id="map_canvas" style="width:100%;height:600px"></div>

//
<script >
var map;
var sourcescraper = 'job_centre_isle_of_man';
var icon = 'http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=X|0f0|f0f';  
var apiurl = "http://api.scraperwiki.com/api/1.0/datastore/sqlite"; 
//var sqlselect = "select geoLat, geoLng, EndDate, Address, Job, Firm from JobTable where EndDate >= DATE()";
var sqlselect = "select geoLat, geoLng, EndDate, Address, Job, Firm from JobTable limit 2";
function makemap()
{
    var cpos = new google.maps.LatLng(54.236107,-4.548056); 
    var mapOptions = { "zoom": 10, "center": cpos, "mapTypeId": google.maps.MapTypeId.ROADMAP };
    map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

//    var coords = "select geoLat, geoLng from JobTable";

    $.ajax({url:apiurl, dataType: "jsonp", data:{name:sourcescraper, query:sqlselect, format:"jsonlist"}, success:function(tdata)
    { 
    
        var data = tdata.data; 
        console.log(data); 
        
        for (var i = 0; i < data.length; i++)
            
            var marker = new google.maps.Marker({position:new google.maps.LatLng(data[i][0], data[i][1]), map:map, title: "Job :" +data[i][4]+ ", Firm: " + data[i][5]} );
            
//            var jobContent = data[i][4];
            var contentString = 'Job: ' + "<br/>Firm:a ";
//                            + data[i][5])"<br/>Address: " + data[i][3] +
//                            "<br/>End date: " + data[i][2]+ ".";

//            var contentString = '<div id="content">'+
//                                '<div id="siteNotice">'+
//                                '</div>'+
//                                '<h1 id="firstHeading" class="firstHeading">Job: '+ data[i][4] +'</h1>'+
//                                '<div id="bodyContent">'+
//                                '<p><b>Uluru</b>, also referred to as <b>Ayers Rock</b>, is a large ' +
//                                'sandstone rock formation in the southern part of the '+
//                                'Northern Territory, central Australia. It lies 335 km (208 mi) '+
//                                'south west of the nearest large town, Alice Springs; 450 km '+
//                                '(280 mi) by road. Kata Tjuta and Uluru are the two major '+
//                                'features of the Uluru - Kata Tjuta National Park. Uluru is '+
//                                'sacred to the Pitjantjatjara and Yankunytjatjara, the '+
//                                'Aboriginal people of the area. It has many springs, waterholes, '+
//                                'rock caves and ancient paintings. Uluru is listed as a World '+
//                                'Heritage Site.</p>'+
//                                '<p>Attribution: Uluru, <a href="http://en.wikipedia.org/w/index.php?title=Uluru&oldid=297882194">'+
//                                'http://en.wikipedia.org/w/index.php?title=Uluru</a> (last visited June 22, 2009).</p>'+
//                                '</div>'+
//                                '</div>';

//            var contentString = "Hello!!" + data['i']['4'];
//
            infowindow = new google.maps.InfoWindow({content: 'Job: '});
     
            google.maps.event.addListener(marker, 'click', function() {  
//                infowindow.content = this.title+infowindow.content; 
                infowindow.open(map,marker)
            });
    }});                           
}


$(window).ready(function() 
{
    $("h2 span").text(sourcescraper); 
    makemap(); 
});
</script>
    
</body>
</html>

