#
# 
#

ScraperWiki::httpresponseheader("Content-Type", "application/xml")
ScraperWiki::attach('dlcourses') 
data = ScraperWiki::select('* FROM dlcourses.swdata')
now  = Time.now.strftime("%Y-%m-%dT%H:%M:%S.%L")

xml = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<catalog
  xmlns=\"http://xcri.org/profiles/1.2/catalog\"
  xmlns:xcriTerms=\"http://xcri.org/profiles/catalog/terms\"
  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"
  xmlns:xhtml=\"http://www.w3.org/1999/xhtml\"
  xmlns:dc=\"http://purl.org/dc/elements/1.1/\"
  xmlns:dcterms=\"http://purl.org/dc/terms/\"
  xmlns:credit=\"http://purl.org/net/cm\"
  xmlns:mlo=\"http://purl.org/net/mlo\"
  xmlns:courseDataProgramme=\"http://xcri.co.uk\"
  xsi:schemaLocation=\"http://xcri.org/profiles/1.2/catalog http://www.xcri.co.uk/bindings/xcri_cap_1_2.xsd http://xcri.org/profiles/1.2/catalog/terms  http://www.xcri.co.uk/bindings/xcri_cap_terms_1_2.xsd http://xcri.co.uk http://www.xcri.co.uk/bindings/coursedataprogramme.xsd\"
  generated=\"#{now}\">
  <dc:contributor>Craig Russell, cr59@le.ac.uk</dc:contributor>
  <dc:description>Demo XCRI-CAP 1.2 file of distance learning courses generated by ScraperWiki</dc:description>
  <provider>
    <dc:description>The University of Leicester is a leading UK University committed to international excellence through the creation of world changing research and high quality, inspirational teaching. Leicester is the most socially inclusive of Britain's top-20 leading universities.</dc:description>
    <dc:identifier>http://www.le.ac.uk</dc:identifier>
    <dc:title>The University of Leicester</dc:title>
    <mlo:url>http://www.le.ac.uk</mlo:url>
    "

data.each do |course|
  xml += "
    <course>
      <dc:description href=\"#{course['url']}\"/>
      <dc:identifier>#{course['url']}</dc:identifier>
      <dc:subject>#{course['title']}</dc:subject>
      <dc:title>#{course['title']}</dc:title>
      <mlo:url>#{course['url']}</mlo:url>
      <abstract>none</abstract>
    </course>
    "
end

xml += "
    <mlo:location>
      <mlo:town>Leicester</mlo:town>
      <mlo:postcode>LE1 7RH</mlo:postcode>
      <mlo:address>University Road</mlo:address>
      <mlo:address>Leicester</mlo:address>
      <mlo:phone>0116 2522522</mlo:phone>
      <mlo:fax>0116 2522200</mlo:fax>
      <mlo:email>xxx@le.ac.uk</mlo:email>
      <mlo:url>http://www2.le.ac.uk/maps</mlo:url>
    </mlo:location>

  </provider>
</catalog>"

puts xml#
# 
#

ScraperWiki::httpresponseheader("Content-Type", "application/xml")
ScraperWiki::attach('dlcourses') 
data = ScraperWiki::select('* FROM dlcourses.swdata')
now  = Time.now.strftime("%Y-%m-%dT%H:%M:%S.%L")

xml = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>
<catalog
  xmlns=\"http://xcri.org/profiles/1.2/catalog\"
  xmlns:xcriTerms=\"http://xcri.org/profiles/catalog/terms\"
  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"
  xmlns:xhtml=\"http://www.w3.org/1999/xhtml\"
  xmlns:dc=\"http://purl.org/dc/elements/1.1/\"
  xmlns:dcterms=\"http://purl.org/dc/terms/\"
  xmlns:credit=\"http://purl.org/net/cm\"
  xmlns:mlo=\"http://purl.org/net/mlo\"
  xmlns:courseDataProgramme=\"http://xcri.co.uk\"
  xsi:schemaLocation=\"http://xcri.org/profiles/1.2/catalog http://www.xcri.co.uk/bindings/xcri_cap_1_2.xsd http://xcri.org/profiles/1.2/catalog/terms  http://www.xcri.co.uk/bindings/xcri_cap_terms_1_2.xsd http://xcri.co.uk http://www.xcri.co.uk/bindings/coursedataprogramme.xsd\"
  generated=\"#{now}\">
  <dc:contributor>Craig Russell, cr59@le.ac.uk</dc:contributor>
  <dc:description>Demo XCRI-CAP 1.2 file of distance learning courses generated by ScraperWiki</dc:description>
  <provider>
    <dc:description>The University of Leicester is a leading UK University committed to international excellence through the creation of world changing research and high quality, inspirational teaching. Leicester is the most socially inclusive of Britain's top-20 leading universities.</dc:description>
    <dc:identifier>http://www.le.ac.uk</dc:identifier>
    <dc:title>The University of Leicester</dc:title>
    <mlo:url>http://www.le.ac.uk</mlo:url>
    "

data.each do |course|
  xml += "
    <course>
      <dc:description href=\"#{course['url']}\"/>
      <dc:identifier>#{course['url']}</dc:identifier>
      <dc:subject>#{course['title']}</dc:subject>
      <dc:title>#{course['title']}</dc:title>
      <mlo:url>#{course['url']}</mlo:url>
      <abstract>none</abstract>
    </course>
    "
end

xml += "
    <mlo:location>
      <mlo:town>Leicester</mlo:town>
      <mlo:postcode>LE1 7RH</mlo:postcode>
      <mlo:address>University Road</mlo:address>
      <mlo:address>Leicester</mlo:address>
      <mlo:phone>0116 2522522</mlo:phone>
      <mlo:fax>0116 2522200</mlo:fax>
      <mlo:email>xxx@le.ac.uk</mlo:email>
      <mlo:url>http://www2.le.ac.uk/maps</mlo:url>
    </mlo:location>

  </provider>
</catalog>"

puts xml