<?php

# Blank PHP
# require 'scraperwiki/simple_html_dom.php';
# $html_content = scraperwiki::scrape("https://www.serviziocontrattipubblici.it/ricerca/dett_ba_lav.aspx?id=75648");
# $html = str_get_html($html_content);

require 'scraperwiki/simple_html_dom.php';

function do_post_request($url, $data, $optional_headers = null)
{
  $params = array('http' => array(
              'method' => 'POST',
              'content' => $data
            ));
  if ($optional_headers !== null) {
    $params['http']['header'] = $optional_headers;
  }
  $ctx = stream_context_create($params);
  $fp = @fopen($url, 'rb', false, $ctx);
  if (!$fp) {
    throw new Exception("Problem with $url, $php_errormsg");
  }
  $response = @stream_get_contents($fp);
  if ($response === false) {
    throw new Exception("Problem reading data from $url, $php_errormsg");
  }
  return $response;
}

$url="https://www.serviziocontrattipubblici.it/ricerca/cerca_appalti.aspx";

$data = array ('__VIEWSTATE'=>'/wEPDwUKMTgxNzcwMzIxNA9kFggCBQ9kFgICAQ8WAh4HVmlzaWJsZWdkAgkPZBYEAgEPZBYEAgEPDxYCHgRUZXh0ZGRkAgMPZBYCZg8PFgIfAWRkZAIDDxYCHwBnZAILD2QWCAIEDxAPFgIeC18hRGF0YUJvdW5kZ2QQFRYNLSBxdWFsc2lhc2kgLQdBYnJ1enpvCkJhc2lsaWNhdGEIQ2FsYWJyaWEIQ2FtcGFuaWEORW1pbGlhLVJvbWFnbmEVRnJpdWxpIFZlbmV6aWEgR2l1bGlhBUxhemlvB0xpZ3VyaWEJTG9tYmFyZGlhBk1hcmNoZQZNb2xpc2UIUGllbW9udGUdUHJvdmluY2lhIGF1dG9ub21hIGRpIEJvbHphbm8cUHJvdmluY2lhIGF1dG9ub21hIGRpIFRyZW50bwZQdWdsaWEIU2FyZGVnbmEHU2ljaWxpYQdUb3NjYW5hBlVtYnJpYQ1WYWxsZSBkJ0Fvc3RhBlZlbmV0bxUWDS0gcXVhbHNpYXNpIC0HQWJydXp6bwpCYXNpbGljYXRhCENhbGFicmlhCENhbXBhbmlhDkVtaWxpYS1Sb21hZ25hFUZyaXVsaSBWZW5lemlhIEdpdWxpYQVMYXppbwdMaWd1cmlhCUxvbWJhcmRpYQZNYXJjaGUGTW9saXNlCFBpZW1vbnRlHVByb3ZpbmNpYSBhdXRvbm9tYSBkaSBCb2x6YW5vHFByb3ZpbmNpYSBhdXRvbm9tYSBkaSBUcmVudG8GUHVnbGlhCFNhcmRlZ25hB1NpY2lsaWEHVG9zY2FuYQZVbWJyaWENVmFsbGUgZCdBb3N0YQZWZW5ldG8UKwMWZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2RkAgUPEA8WAh8CZ2QQFW8NLSBxdWFsc2lhc2kgLQlBZ3JpZ2VudG8LQWxlc3NhbmRyaWEGQW5jb25hBUFvc3RhBkFyZXp6bw1Bc2NvbGkgUGljZW5vBEFzdGkIQXZlbGxpbm8EQmFyaRVCYXJsZXR0YS1BbmRyaWEtVHJhbmkHQmVsbHVubwlCZW5ldmVudG8HQmVyZ2FtbwZCaWVsbGEHQm9sb2duYQdCb2x6YW5vB0JyZXNjaWEIQnJpbmRpc2kIQ2FnbGlhcmkMQ2FsdGFuaXNldHRhCkNhbXBvYmFzc28RQ2FyYm9uaWEtSWdsZXNpYXMHQ2FzZXJ0YQdDYXRhbmlhCUNhdGFuemFybwZDaGlldGkEQ29tbwdDb3NlbnphB0NyZW1vbmEHQ3JvdG9uZQVDdW5lbwRFbm5hBUZlcm1vB0ZlcnJhcmEHRmlyZW56ZQZGb2dnaWENRm9ybMOsLUNlc2VuYQlGcm9zaW5vbmUGR2Vub3ZhB0dvcml6aWEIR3Jvc3NldG8HSW1wZXJpYQdJc2VybmlhCUxhIFNwZXppYQhMJ0FxdWlsYQZMYXRpbmEFTGVjY2UFTGVjY28HTGl2b3JubwRMb2RpBUx1Y2NhCE1hY2VyYXRhB01hbnRvdmENTWFzc2EgQ2FycmFyYQZNYXRlcmEPTWVkaW8gQ2FtcGlkYW5vB01lc3NpbmEGTWlsYW5vBk1vZGVuYQ9Nb256YSBlIEJyaWFuemEGTmFwb2xpBk5vdmFyYQVOdW9ybwlPZ2xpYXN0cmEMT2xiaWEtVGVtcGlvCE9yaXN0YW5vBlBhZG92YQdQYWxlcm1vBVBhcm1hBVBhdmlhB1BlcnVnaWENUGVzYXJvLXVyYmlubwdQZXNjYXJhCFBpYWNlbnphBFBpc2EHUGlzdG9pYQlQb3JkZW5vbmUHUG90ZW56YQVQcmF0bwZSYWd1c2EHUmF2ZW5uYRJSZWdnaW8gZGkgQ2FsYWJyaWESUmVnZ2lvIG5lbGwnRW1pbGlhBVJpZXRpBlJpbWluaQRSb21hBlJvdmlnbwdTYWxlcm5vB1Nhc3NhcmkGU2F2b25hBVNpZW5hCFNpcmFjdXNhB1NvbmRyaW8HVGFyYW50bwZUZXJhbW8FVGVybmkGVG9yaW5vB1RyYXBhbmkGVHJlbnRvB1RyZXZpc28HVHJpZXN0ZQVVZGluZQZWYXJlc2UHVmVuZXppYRRWZXJiYW5vLUN1c2lvLU9zc29sYQhWZXJjZWxsaQZWZXJvbmENVmlibyBWYWxlbnRpYQdWaWNlbnphB1ZpdGVyYm8VbwACQUcCQUwCQU4CQU8CQVICQVACQVQCQVYCQkECQlQCQkwCQk4CQkcCQkkCQk8CQloCQlMCQlICQ0ECQ0wCQ0ICQ0kCQ0UCQ1QCQ1oCQ0gCQ08CQ1MCQ1ICS1ICQ04CRU4CRk0CRkUCRkkCRkcCRkMCRlICR0UCR08CR1ICSU0CSVMCU1ACQVECTFQCTEUCTEMCTEkCTE8CTFUCTUMCTU4CTVMCTVQCVlMCTUUCTUkCTU8CTUICTkECTk8CTlUCT0cCT1QCT1ICUEQCUEECUFICUFYCUEcCUFUCUEUCUEMCUEkCUFQCUE4CUFoCUE8CUkcCUkECUkMCUkUCUkkCUk4CUk0CUk8CU0ECU1MCU1YCU0kCU1ICU08CVEECVEUCVFICVE8CVFACVE4CVFYCVFMCVUQCVkECVkUCVkICVkMCVlICVlYCVkkCVlQUKwNvZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZGQCBw8QDxYCHwJnZBAVJg0tIHF1YWxzaWFzaSAtIUFMVFJJIFNPR0dFVFRJIFBVQkJMSUNJIEUgUFJJVkFUSRxBTU1JTklTVFJBWklPTkkgSU5ESVBFTkRFTlRJF0FTU09DSUFaSU9ORSBESSBJTVBSRVNFMkFTU09DSUFaSU9OSSBESSBDQVRFR09SSUEgRSBPUkdBTklaWkFaSU9OSSBTSU5EQUNBE0FVVE9SSVRBJyBESSBCQUNJTk8oQVpJRU5ERSBERUwgU0VSVklaSU8gU0FOSVRBUklPIE5BWklPTkFMRSBBWklFTkRFIFNQRUNJQUxJIE1VTklDSVBBTElaWkFURSFBWklFTkRFIFNQRUNJQUxJIFBST1ZJTkNJQUxJWlpBVEUfQVpJRU5ERSBTUEVDSUFMSSBSRUdJT05BTElaWkFURRNDQU1FUkUgREkgQ09NTUVSQ0lPBkNPTVVOSRFDT01VTklUQScgTU9OVEFORTJDT05DRVNTSU9OQVJJIEUgSU1QUkVTRSBESSBHRVNUSU9ORSBSRVRJIEUgSU5GUkFTVC9DT05TT1JaSSBBVVRPTk9NSSBESSBSRUdJT05JLCBQUk9WSU5DRSBFIENPTVVOSRNDT05TT1JaSSBESSBJTVBSRVNFH0NPTlNPUlpJIERJIElORFVTVFJJQUxJWlpBWklPTkUkQ09OU09SWkkgRU5USSAgRUQgQVVUT1JJVEEnIFBPUlRVQUxJJ0VOVEkgREkgQk9OSUZJQ0EgRSBESSBTVklMVVBQTyBBR1JJQ09MTyBFTlRJIERJIFBSRVZJREVOWkEgRSBQUkVWRU5aSU9ORShFTlRJIERJIFBST01PWklPTkUgQ1VMVFVSQUxFIEUgQVJUSVNUSUNBGkVOVEkgRUQgSVNUSVRVVEkgUkVMSUdJT1NJI0VOVEkgUFJFUE9TVEkgQUQgQVRUSVZJVEEnIFNQT1JUSVZFMEVOVEkgU0NJRU5USUZJQ0kgREkgUklDRVJDQSBFIERJIFNQRVJJTUVOVEFaSU9ORTJJTVBSRVNFICBFRCBBTFRSSSBTT0dHRVRUSSBQUklWQVRJIE5PTiBJTiBGT1JNQSBBUyFJTVBSRVNFIEEgUEFSVEVDSVBBWklPTkUgUFVCQkxJQ0EfSVNUSVRVVEkgQVVUT05PTUkgQ0FTRSBQT1BPTEFSSR1JU1RJVFVUSSBCQU5DQVJJIEUgRklOQU5aSUFSSRNJU1RJVFVaSU9OSSBFVVJPUEVFFUxJQkVSSSBQUk9GRVNTSU9OSVNUSQlNSU5JU1RFUkkVT1JHQU5JIENPU1RJVFVaSU9OQUxJI09SR0FOSSBHSVVSSVNESVpJT05BTEkgRSBBVlZPQ0FUVVJBCFBST1ZJTkNFB1JFR0lPTkkWU09DSUVUQScgREkgSU5HRUdORVJJQQ9TT0dHRVRUSSBFU1RFUkkZVU5JVkVSU0lUQScgRUQgQUxUUkkgRU5USRUmDS0gcXVhbHNpYXNpIC0hQUxUUkkgU09HR0VUVEkgUFVCQkxJQ0kgRSBQUklWQVRJHEFNTUlOSVNUUkFaSU9OSSBJTkRJUEVOREVOVEkXQVNTT0NJQVpJT05FIERJIElNUFJFU0UyQVNTT0NJQVpJT05JIERJIENBVEVHT1JJQSBFIE9SR0FOSVpaQVpJT05JIFNJTkRBQ0ETQVVUT1JJVEEnIERJIEJBQ0lOTyhBWklFTkRFIERFTCBTRVJWSVpJTyBTQU5JVEFSSU8gTkFaSU9OQUxFIEFaSUVOREUgU1BFQ0lBTEkgTVVOSUNJUEFMSVpaQVRFIUFaSUVOREUgU1BFQ0lBTEkgUFJPVklOQ0lBTElaWkFURR9BWklFTkRFIFNQRUNJQUxJIFJFR0lPTkFMSVpaQVRFE0NBTUVSRSBESSBDT01NRVJDSU8GQ09NVU5JEUNPTVVOSVRBJyBNT05UQU5FMkNPTkNFU1NJT05BUkkgRSBJTVBSRVNFIERJIEdFU1RJT05FIFJFVEkgRSBJTkZSQVNUL0NPTlNPUlpJIEFVVE9OT01JIERJIFJFR0lPTkksIFBST1ZJTkNFIEUgQ09NVU5JE0NPTlNPUlpJIERJIElNUFJFU0UfQ09OU09SWkkgREkgSU5EVVNUUklBTElaWkFaSU9ORSRDT05TT1JaSSBFTlRJICBFRCBBVVRPUklUQScgUE9SVFVBTEknRU5USSBESSBCT05JRklDQSBFIERJIFNWSUxVUFBPIEFHUklDT0xPIEVOVEkgREkgUFJFVklERU5aQSBFIFBSRVZFTlpJT05FKEVOVEkgREkgUFJPTU9aSU9ORSBDVUxUVVJBTEUgRSBBUlRJU1RJQ0EaRU5USSBFRCBJU1RJVFVUSSBSRUxJR0lPU0kjRU5USSBQUkVQT1NUSSBBRCBBVFRJVklUQScgU1BPUlRJVkUwRU5USSBTQ0lFTlRJRklDSSBESSBSSUNFUkNBIEUgREkgU1BFUklNRU5UQVpJT05FMklNUFJFU0UgIEVEIEFMVFJJIFNPR0dFVFRJIFBSSVZBVEkgTk9OIElOIEZPUk1BIEFTIUlNUFJFU0UgQSBQQVJURUNJUEFaSU9ORSBQVUJCTElDQR9JU1RJVFVUSSBBVVRPTk9NSSBDQVNFIFBPUE9MQVJJHUlTVElUVVRJIEJBTkNBUkkgRSBGSU5BTlpJQVJJE0lTVElUVVpJT05JIEVVUk9QRUUVTElCRVJJIFBST0ZFU1NJT05JU1RJCU1JTklTVEVSSRVPUkdBTkkgQ09TVElUVVpJT05BTEkjT1JHQU5JIEdJVVJJU0RJWklPTkFMSSBFIEFWVk9DQVRVUkEIUFJPVklOQ0UHUkVHSU9OSRZTT0NJRVRBJyBESSBJTkdFR05FUklBD1NPR0dFVFRJIEVTVEVSSRlVTklWRVJTSVRBJyBFRCBBTFRSSSBFTlRJFCsDJmdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZGQCDQ8QDxYCHwJnZBAVMQNPRzEDT0cyA09HMwNPRzQDT0c1A09HNgNPRzcDT0c4A09HOQRPRzEwBE9HMTEET0cxMgRPRzEzA09TMQNPUzIDT1MzA09TNANPUzUDT1M2A09TNwNPUzgDT1M5BE9TMTAET1MxMQRPUzEyBE9TMTMET1MxNARPUzE1BE9TMTYET1MxNwRPUzE4BE9TMTkET1MyMARPUzIxBE9TMjIET1MyMwRPUzI0BE9TMjUET1MyNgRPUzI3BE9TMjgET1MyOQRPUzMwBE9TMzEET1MzMgRPUzMzBE9TMzQ4RScgc3RhdG8gdXRpbGl6emF0byB1biBwcm9wcmlvIHNpc3RlbWEgZGkgcXVhbGlmaWNhemlvbmUNLSBxdWFsc2lhc2kgLRUxA09HMQNPRzIDT0czA09HNANPRzUDT0c2A09HNwNPRzgDT0c5BE9HMTAET0cxMQRPRzEyBE9HMTMDT1MxA09TMgNPUzMDT1M0A09TNQNPUzYDT1M3A09TOANPUzkET1MxMARPUzExBE9TMTIET1MxMwRPUzE0BE9TMTUET1MxNgRPUzE3BE9TMTgET1MxOQRPUzIwBE9TMjEET1MyMgRPUzIzBE9TMjQET1MyNQRPUzI2BE9TMjcET1MyOARPUzI5BE9TMzAET1MzMQRPUzMyBE9TMzMET1MzNDhFJyBzdGF0byB1dGlsaXp6YXRvIHVuIHByb3ByaW8gc2lzdGVtYSBkaSBxdWFsaWZpY2F6aW9uZQ0tIHF1YWxzaWFzaSAtFCsDMWdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dkZAIND2QWDAIBDw8WAh8BBQUxNTI4NmRkAgMPDxYCHwEFATZkZAIFDw8WAh8BBQM5NTlkZAIHDw8WAh8BBQUyNjQ5N2RkAgkPDxYCHwEFBDIxNzJkZAILDw8WAh8BBQQ1MjU4ZGQYAQUeX19Db250cm9sc1JlcXVpcmVQb3N0QmFja0tleV9fFgUFAnBmBQJwZgUCYmEFA2FnZwUDYWdn2lDdYh9xBPHKUn8EnINqr5oNLmQ=',
                '__EVENTVALIDATION'=>'/wEW6wECrvG2owMCwqKf6g8CrKKr6g8ClJjn0QkCz7uG8QQChZvotAMC4sqnuwkC39jipQoC1+iunggC18r0iwcChJnKrAUCoN+nvwIC+bft9QECv5CfjQ4CrpW0nAwClfG6vgsCodq5owECiqvZnQsC+Kmv3g8Cm+n20g4C94HOpA4Ckva+wgUC4Kf/yw0ChfjDvwUCw+Sh4AkCv6T+0AQC9dnk4QkCqrbqkQUCqrbekQUCqrbWkQUCqrbKkQUCqraGkQUCqraOkQUCqra+kQUCqra2kQUCq7bCkQUCq7a+kQUCq7bekQUCq7bWkQUCq7bqkQUCq7aikQUCq7bKkQUCq7bmkAUCq7a6kQUCq7aGkQUCqLbCkQUCqLbekQUCqLbGkQUCqLaikQUCqLbykQUCqLa+kQUCqLbmkAUCqLaukQUCqLbKkQUCqLa6kQUCqLaGkQUCkLaGkQUCqLbWkQUCrrbWkQUCr7bSkQUCr7bykQUCr7aikQUCr7bqkQUCr7b6kQUCr7aGkQUCrLbykQUCrLbKkQUCrLaGkQUCkrbSkQUCkra6kQUCmLaOkQUCqraCkQUCkba+kQUCkbbykQUCkbb6kQUCkbaikQUCkbbKkQUCkbaykQUClrb6kQUClrbWkQUClra6kQUClra+kQUCn7a6kQUClrbykQUClraikQUClrbKkQUClrbGkQUCl7bCkQUCl7bKkQUCl7aykQUClLbqkQUClLa+kQUClLaGkQUChbb+kQUChbbCkQUChbaGkQUChba2kQUChbbqkQUChbaykQUChbbykQUChbb6kQUChbaikQUChba+kQUChbbWkQUChbbmkAUChbbKkQUCm7bqkQUCm7bCkQUCm7b6kQUCm7bykQUCm7aikQUCm7bWkQUCm7bSkQUCm7bKkQUCmLbCkQUCmLa6kQUCmLa2kQUCmLaikQUCmLaGkQUCmLbKkQUCmbbCkQUCmbbykQUCmbaGkQUCmbbKkQUCmbaOkQUCmbbWkQUCmba2kQUCmba6kQUCnrb+kQUCn7bCkQUCn7bykQUCn7bGkQUCn7b6kQUCn7aGkQUCn7a2kQUCn7aikQUCn7a+kQUCzt6XtAgCpbrm1AkCgYDN9g8CtOjaqQEC6tb5vQcC+Z+3nAkC/rXFug4CxNaU3gcC0tvNvQoCourVwgcC2MPL9QUCjtGdsAkC87D2+AQCs4nPmg4CuaCt/gICz6SAowoC6pjwuwEC2+i24wICu8famgMCmbfO9gMCvtvkHwK/rtGDAwLwguGzDgKl5/TNAwLH5dydAQL4wezNBgL46sXgAgLHiNEKAsm+4IcBAsDPsekBAvbwxscEAp/8o+AHAsWA0IQGAvfo+KQDAuDswI8IAuqAlaAOAo+z/cIPAt3vtYALAvTE4pELAumD2ccFAvaD2ccFAveD2ccFAvSD2ccFArnY994JAqaU4c8CAt+Ul/QJAqW9pL8CAoKkhogIAv/P4ZIOAtT2w/8DArGYrcgJAq6Dj9UPAouq6b8FApDAqfwNAo3ri8kDAqW95PENAqW9kK0GAqW9jIYPAqW9uOMHAqW99LwCAoKk1okIAv/PsZIOAtT2k/8DArGY/ckJAq6D39IPAouqub8FApDA+f0NAo3r28YDAqW9tPENAqW9oKoGAqW93IcPAqW9yOAHAqW95F0Cpb2QuQkCpb2MkgICpb24zwoCpb2UlggCpb2AcwKCpJbaAwKCpIK3DAKCpL6QBQKCpKrNDQKCpMamBgKCpPKDDwKCpO78BwKCpJpYAoKk9uANAoKk4t0GAv/P8aQJAv/P7YECAv/Pmf0KAv/PtdYDAv/PobMMAvyZlasJAoOlwrcCAvr46JIEAsP56J4EAsfSkvwJC5OCPYIFfdpQqXssLuILix+lNhA=',
               'tipoappalto'=>'ba',
                'regioni'=>'Abruzzo',
                'province'=>'',
                'tipo_ente'=>'- qualsiasi -',
                'tipoapp'=>'1',
                'imp_fino_a'=>'',
                'cat_qual'=>'- qualsiasi -',
                'pubbl_dopo'=>'',
                'pubbl_prima'=>''
            );
$data = http_build_query($data);

#print $data;

$risposta = do_post_request($url, $data, $optional_headers = null);

$rispostavera=explode('<html',$risposta);
#print $rispostavera[0];

#print $rispostavera[1];

#$html_content = scraperwiki::scrape("https://www.serviziocontrattipubblici.it/ricerca/dett_ba_lav.aspx?id=75648");
$html = str_get_html('<html'.$rispostavera[1]);
$anchors = $html->find("a[href*=dett_ba_lav.aspx]");


foreach ($anchors as $a) { print $a . " - " . $a->href . "\n"; }

?>
