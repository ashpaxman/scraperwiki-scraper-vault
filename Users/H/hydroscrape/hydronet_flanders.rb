#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

require 'rubygems'
require 'date'
require 'uri'
require 'net/http'

STATIONS = {890195=>"4412220,4390435", 1131998=>"1132274,1132373", 17848900=>"17849090,17849078", 2834334=>"22864498,22864495", 1736673=>"19108535,11085581", 5001382=>"5001583,5001573", 21559059=>"21559073,21559129", 3040326=>"3040602,17271076", 6791254=>"8791845,6791450", 6216662=>"22754835,6216808", 1533898=>"20043824,4390639", 22786365=>"22786547,22786537", 10590824=>"10593418,10593380", 861520=>"4411187,4389178", 1640663=>"1640869,1640899", 1644348=>"1644434,1644464", 939240=>"4412390,4390289", 1206704=>"1208233,1208222", 22782513=>"22782695,22782685", 22753837=>"22753887,22753904", 2840030=>"7967978,7964892", 1474805=>"1474893,1474932", 2842878=>"7964887,7964691", 4290145=>"4290193,4290210", 1323519=>"4413274,4413268", 2898756=>"2898846,2898885", 2831488=>"9063826,9063820", 1168615=>"1168703,1168632", 839310=>"4410933,4386963", 2819160=>"22864352,10911802", 23155637=>"23155821,23155811", 13661469=>"13663326,13663283", 6104070=>"7724839,7724649", 894820=>"4410995,4390174", 17432765=>"17432960,17432950", 1836070=>"1836176,1836206", 810635=>"4410800,4386637", 1192669=>"1192757,1192686", 1839353=>"1839439,1839469", 22719836=>"22719838,22719960", 1477855=>"1478103,1478142", 1527636=>"4412095,4390763", 23141166=>"23141360,23141350", 4784908=>"8790942,4785104", 1175685=>"1176201,1176190", 4725278=>"7725903,7725897", 1329584=>"4413495,4413489", 22792096=>"22857683,22857700", 827285=>"4411132,4386880", 921655=>"4412255,4389722", 17259873=>"17260553,17260609", 6218106=>"22753308,6218132", 1208583=>"1209262,1209253", 4288037=>"4288085,4288102", 11153460=>"11153508,11153525", 1181917=>"1182005,1181934", 7212319=>"8791517,8791511", 8096987=>"8280497,19790700", 23155405=>"23155579,23155569", 931840=>"4411097,4389649", 22774242=>"22774444,22774434", 815260=>"4411167,3029555", 22721312=>"22721314,22721386", 2142296=>"4412025,4390757", 22783857=>"22784039,22784029", 1169322=>"1169598,1169587", 831910=>"4411172,4386837", 22788246=>"22788428,22788418", 972242=>"4410873,2324552", 23300327=>"23300501,23300491", 1643649=>"1643735,1643765", 7210411=>"7210597,7210653", 2890586=>"2890674,2890713", 887420=>"4410747,4389600", 2893936=>"2894026,2894065", 384083=>"384313,384248", 1142456=>"1142544,1142473", 1176392=>"1176480,1176409", 22731967=>"22732172,22732162", 936465=>"4412350,4389264", 1129961=>"1130918,6641455", 23156111=>"23156285,23156275", 2803186=>"7725955,7725949", 836535=>"4410622,4389064", 1688976=>"1689064,1689094", 1261215=>"4412250,4389348", 4290553=>"4290601,4290618", 22789722=>"22789954,22789944", 6586643=>"6587319,6587375", 22778064=>"22778246,22778236", 892045=>"4410850,4390444", 382845=>"383075,383010", 2141528=>"4413078,4390744", 22753542=>"22753592,22753609", 1119209=>"1119297,1503002", 1170029=>"1170305,1170294", 941090=>"4397297,4389380", 1324732=>"4413869,4413833", 824510=>"4410855,4389725", 1692998=>"1693926,1693956", 1625730=>"1625848,1625887", 918880=>"4410717,4390337", 896670=>"4410990,4390149", 1195356=>"1195444,1195373", 5618830=>"7725792,7725696", 1119847=>"1119935,6534642", 1689682=>"1689780,1689810", 23155879=>"23156053,23156043", 1647204=>"1647290,1647320", 22785738=>"22785920,22785910", 1127653=>"1128370,1838305", 4288445=>"4288493,4288510", 23053068=>"23053116,23053138", 1642950=>"1643036,1643066", 812485=>"4412280,4386787", 1474043=>"1474131,1474170", 1177099=>"1177187,1177116", 1330797=>"1330903,1330832", 829135=>"4410878,4390592", 2464136=>"7775646,7775640", 23155143=>"23155347,23155337", 2864796=>"7725135,7725129", 6576462=>"20042930,6576651", 22781886=>"22782068,22782058", 923505=>"4412140,4389671", 1120485=>"1120573,6638222", 1184604=>"1184692,1184621", 2892166=>"2892256,2892295", 1630556=>"1630644,1630683", 1735746=>"4411192,4390785", 845785=>"4397302,4389005", 901295=>"4412020,4389603", 2926906=>"7775544,7775538", 5000690=>"5000891,5000881", 6636227=>"6636306,6636263", 1136767=>"1136855,6638363", 21558970=>"21558984,21559040", 3099666=>"8690625,4413083", 1170736=>"1171012,1171001", 6216037=>"8791475,8791469", 22779945=>"22780127,22780117", 4366737=>"4367830,4367894", 1121123=>"1121211,6638541", 4575978=>"4576037,4575994", 1258440=>"4412017,4389155", 6473720=>"6473916,6473972", 1177806=>"1177894,4745318", 860595=>"4411112,4390570", 1646505=>"1646591,1646621", 1121761=>"1121849,6638076", 1688246=>"1688334,1688364", 1113185=>"1113737,1113845", 1478637=>"1478735,1478774", 1133386=>"1133662,1133770", 838385=>"6678019,4390126", 916105=>"5498935,4389690", 1642251=>"1642337,1642367", 1166484=>"1166582,3119892", 18333258=>"18333320,18333394", 7211057=>"7211243,7211299", 22787619=>"22787801,22787791", 855035=>"4412225,4389280", 1171443=>"1171719,1171708", 11287974=>"11292198,19766209", 17498740=>"17498788,17498747", 1325945=>"4413686,4413680", 22791472=>"22860647,22860664", 23250623=>"23251059,23251020", 23131631=>"23131815,23131805", 1122399=>"1122487,6638154", 6660653=>"6661523,6661574", 4784318=>"8691296,8691187", 1479409=>"1479497,1479536", 22776163=>"22776365,22776355", 23139169=>"23139393,23139383", 4284967=>"4285015,4285032", 826360=>"4412400,4390193", 1688952=>"1692380,1692410", 18326057=>"18326203,18326165", 920730=>"4410722,4390362", 2826746=>"9068983,9067981", 1332010=>"4413970,4413874", 1693006=>"1693094,1693124", 1721146=>"1721232,1721262", 22777437=>"22777619,22777609", 898520=>"4397767,4390155", 1178513=>"1178789,1178778", 22573355=>"22573403,22792858", 814335=>"4410752,4389286", 1138615=>"1139572,1139561", 4365469=>"4365517,4365534", 17433987=>"17513776,17513766", 886495=>"4410825,4389574", 6474161=>"6474317,6474373", 1645806=>"1645892,1645922", 4336057=>"4336116,4336073", 1198045=>"1198133,1198062", 847635=>"4412285,4390604", 23222989=>"23223333,23223323", 23154649=>"23154853,23154843", 23052675=>"23052723,23052745", 1172150=>"1172426,1172415", 22720992=>"22720994,22721156", 3041216=>"3042264,3042253", 1519311=>"4411327,4390719", 22785111=>"22785293,22785283", 818960=>"4410820,3029510", 22781259=>"22781441,22781431", 913330=>"4411080,4410987", 835610=>"4410927,4389117", 1187293=>"1187985,1187974", 1260290=>"4412045,4389258", 891120=>"4410617,4390438", 1179220=>"1179318,1179247", 22992477=>"22992630,22992686", 1766040=>"1766326,1766315", 1321093=>"4413828,4413792", 4514648=>"4514852,4514842", 1523936=>"22863862,4390623", 1626982=>"1627130,1627169", 862445=>"4412090,4388999", 823585=>"4397717,4389418", 840235=>"4410948,4389120", 4289261=>"4289309,4289326", 1690398=>"1691676,1691706", 22779318=>"22779500,22779490", 5002074=>"8791506,8791500", 2569304=>"8690247,8690241", 917955=>"4412405,4390343", 1172857=>"1173133,1173122", 11483588=>"11483804,11483794", 4999998=>"5000199,5000189", 811560=>"4411010,4386646", 5972470=>"5972616,5972578", 4981138=>"4981335,4981325", 2821058=>"13892103,20787150", 2128211=>"2129997,2129986", 6215412=>"8791334,8791298", 828210=>"4411207,4386640", 1132692=>"1132968,1133067", 844860=>"19073779,4386912", 900370=>"4412395,4389412", 5897900=>"20044462,20043829", 22786992=>"22787174,22787164", 2894826=>"2894916,2894955", 22571721=>"22571769,22735463", 816185=>"4411752,4390598", 23140250=>"23140424,23140414", 932765=>"4397722,4389655", 1128807=>"1129644,6640033", 22783140=>"22783412,22783402", 22775536=>"22775718,22775708", 2562976=>"7726482,7724213", 832835=>"4411817,4390340", 888345=>"4412145,4390396", 4515189=>"7725690,7725204", 22776810=>"22776992,22776982", 4841714=>"4841762,4845437", 4857828=>"10590699,10590693", 1521161=>"4410767,4390687", 937390=>"4410795,4410789", 6246001=>"22988919,6246174", 1189980=>"1190068,1189997", 820810=>"4412355,4386886", 23140018=>"23140192,23140182", 915180=>"4410692,4389687", 892970=>"6680654,4389386", 1650874=>"1651070,1651100", 23052282=>"23052330,23052352", 16656864=>"22874522,22874519", 1322306=>"4413243,4413237", 23131309=>"23131573,23131563", 1652382=>"1652580,1658400", 381526=>"381756,381691", 1525786=>"20080283,19968611", 4783728=>"8691180,4783924", 22784484=>"22784666,22784656", 825435=>"4412040,4386877", 1328371=>"4413787,4413761", 22780632=>"22780814,22780804", 919805=>"4412660,4390368", 22788873=>"22789055,22789045", 9114877=>"9115130,9115120", 1143150=>"1143238,1143167", 345850=>"346077,346013", 1645047=>"1645193,1645223", 23139786=>"23139960,23139950", 929990=>"4410687,4389149", 813410=>"4411747,4386729", 830060=>"4410907,2914832", 6638357=>"6639477,6639528", 5510010=>"5510058,5510621", 885570=>"4411107,4389568", 22778691=>"22778873,22778863", 4730968=>"8690908,8690902", 22572968=>"22573146,22735444", 17499661=>"17500364,17500354", 934615=>"6678013,4389354", 1139769=>"1139857,1139786", 23277909=>"23278153,23278143", 1518386=>"4410953,4390722", 23139554=>"23139728,23139718", 1628802=>"1628890,1628929", 1174978=>"1175254,1175243", 1651683=>"1651769,1651799", 834685=>"4410805,4388967", 1624079=>"1624167,1624206"}

class Hydronet
  include Net

  HOST        = "www.hydronet.be"
  PATH        = "/wiskiwebpublic/tsdata.php"
  DATA_FORMAT = "TEXT"
  DATE_FORMAT = "%Y%m%e000000"

  def initialize(vlid)
    @vlid = vlid
  end

  def water_level
    page = get_page
    extract_water_level_from_page(page)
  end

  private

  def get_page
    uri = build_uri
    HTTP.get(uri)
  end

  def extract_water_level_from_page(page)
    lines           = page.split("\n")
    last_level_line = lines.select{ |line| line.include?("unchecked") && !line.include?("incomplete") }.last
    level           = last_level_line ? last_level_line.split("\t")[1] : nil
    level.to_f
  end

  def build_uri
    query = URI.encode_www_form(build_query)
    URI::HTTP.build(:host => HOST, :path => PATH, :query => query)
  end

  def build_query
    today    = Date.today
    tomorrow = today + 1
    {
      dataformat:  DATA_FORMAT,
      ts_str_from: today.strftime(DATE_FORMAT),
      ts_str_to:   tomorrow.strftime(DATE_FORMAT),
      vlid:        @vlid
    }
  end
end

STATIONS.each do |stationident, vlid|
  puts stationident
  level = Hydronet.new(vlid).water_level
  ScraperWiki::save_sqlite([:stationident], {:stationident => stationident, :level => level, :recorded_at => DateTime.now.iso8601})
end#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

require 'rubygems'
require 'date'
require 'uri'
require 'net/http'

STATIONS = {890195=>"4412220,4390435", 1131998=>"1132274,1132373", 17848900=>"17849090,17849078", 2834334=>"22864498,22864495", 1736673=>"19108535,11085581", 5001382=>"5001583,5001573", 21559059=>"21559073,21559129", 3040326=>"3040602,17271076", 6791254=>"8791845,6791450", 6216662=>"22754835,6216808", 1533898=>"20043824,4390639", 22786365=>"22786547,22786537", 10590824=>"10593418,10593380", 861520=>"4411187,4389178", 1640663=>"1640869,1640899", 1644348=>"1644434,1644464", 939240=>"4412390,4390289", 1206704=>"1208233,1208222", 22782513=>"22782695,22782685", 22753837=>"22753887,22753904", 2840030=>"7967978,7964892", 1474805=>"1474893,1474932", 2842878=>"7964887,7964691", 4290145=>"4290193,4290210", 1323519=>"4413274,4413268", 2898756=>"2898846,2898885", 2831488=>"9063826,9063820", 1168615=>"1168703,1168632", 839310=>"4410933,4386963", 2819160=>"22864352,10911802", 23155637=>"23155821,23155811", 13661469=>"13663326,13663283", 6104070=>"7724839,7724649", 894820=>"4410995,4390174", 17432765=>"17432960,17432950", 1836070=>"1836176,1836206", 810635=>"4410800,4386637", 1192669=>"1192757,1192686", 1839353=>"1839439,1839469", 22719836=>"22719838,22719960", 1477855=>"1478103,1478142", 1527636=>"4412095,4390763", 23141166=>"23141360,23141350", 4784908=>"8790942,4785104", 1175685=>"1176201,1176190", 4725278=>"7725903,7725897", 1329584=>"4413495,4413489", 22792096=>"22857683,22857700", 827285=>"4411132,4386880", 921655=>"4412255,4389722", 17259873=>"17260553,17260609", 6218106=>"22753308,6218132", 1208583=>"1209262,1209253", 4288037=>"4288085,4288102", 11153460=>"11153508,11153525", 1181917=>"1182005,1181934", 7212319=>"8791517,8791511", 8096987=>"8280497,19790700", 23155405=>"23155579,23155569", 931840=>"4411097,4389649", 22774242=>"22774444,22774434", 815260=>"4411167,3029555", 22721312=>"22721314,22721386", 2142296=>"4412025,4390757", 22783857=>"22784039,22784029", 1169322=>"1169598,1169587", 831910=>"4411172,4386837", 22788246=>"22788428,22788418", 972242=>"4410873,2324552", 23300327=>"23300501,23300491", 1643649=>"1643735,1643765", 7210411=>"7210597,7210653", 2890586=>"2890674,2890713", 887420=>"4410747,4389600", 2893936=>"2894026,2894065", 384083=>"384313,384248", 1142456=>"1142544,1142473", 1176392=>"1176480,1176409", 22731967=>"22732172,22732162", 936465=>"4412350,4389264", 1129961=>"1130918,6641455", 23156111=>"23156285,23156275", 2803186=>"7725955,7725949", 836535=>"4410622,4389064", 1688976=>"1689064,1689094", 1261215=>"4412250,4389348", 4290553=>"4290601,4290618", 22789722=>"22789954,22789944", 6586643=>"6587319,6587375", 22778064=>"22778246,22778236", 892045=>"4410850,4390444", 382845=>"383075,383010", 2141528=>"4413078,4390744", 22753542=>"22753592,22753609", 1119209=>"1119297,1503002", 1170029=>"1170305,1170294", 941090=>"4397297,4389380", 1324732=>"4413869,4413833", 824510=>"4410855,4389725", 1692998=>"1693926,1693956", 1625730=>"1625848,1625887", 918880=>"4410717,4390337", 896670=>"4410990,4390149", 1195356=>"1195444,1195373", 5618830=>"7725792,7725696", 1119847=>"1119935,6534642", 1689682=>"1689780,1689810", 23155879=>"23156053,23156043", 1647204=>"1647290,1647320", 22785738=>"22785920,22785910", 1127653=>"1128370,1838305", 4288445=>"4288493,4288510", 23053068=>"23053116,23053138", 1642950=>"1643036,1643066", 812485=>"4412280,4386787", 1474043=>"1474131,1474170", 1177099=>"1177187,1177116", 1330797=>"1330903,1330832", 829135=>"4410878,4390592", 2464136=>"7775646,7775640", 23155143=>"23155347,23155337", 2864796=>"7725135,7725129", 6576462=>"20042930,6576651", 22781886=>"22782068,22782058", 923505=>"4412140,4389671", 1120485=>"1120573,6638222", 1184604=>"1184692,1184621", 2892166=>"2892256,2892295", 1630556=>"1630644,1630683", 1735746=>"4411192,4390785", 845785=>"4397302,4389005", 901295=>"4412020,4389603", 2926906=>"7775544,7775538", 5000690=>"5000891,5000881", 6636227=>"6636306,6636263", 1136767=>"1136855,6638363", 21558970=>"21558984,21559040", 3099666=>"8690625,4413083", 1170736=>"1171012,1171001", 6216037=>"8791475,8791469", 22779945=>"22780127,22780117", 4366737=>"4367830,4367894", 1121123=>"1121211,6638541", 4575978=>"4576037,4575994", 1258440=>"4412017,4389155", 6473720=>"6473916,6473972", 1177806=>"1177894,4745318", 860595=>"4411112,4390570", 1646505=>"1646591,1646621", 1121761=>"1121849,6638076", 1688246=>"1688334,1688364", 1113185=>"1113737,1113845", 1478637=>"1478735,1478774", 1133386=>"1133662,1133770", 838385=>"6678019,4390126", 916105=>"5498935,4389690", 1642251=>"1642337,1642367", 1166484=>"1166582,3119892", 18333258=>"18333320,18333394", 7211057=>"7211243,7211299", 22787619=>"22787801,22787791", 855035=>"4412225,4389280", 1171443=>"1171719,1171708", 11287974=>"11292198,19766209", 17498740=>"17498788,17498747", 1325945=>"4413686,4413680", 22791472=>"22860647,22860664", 23250623=>"23251059,23251020", 23131631=>"23131815,23131805", 1122399=>"1122487,6638154", 6660653=>"6661523,6661574", 4784318=>"8691296,8691187", 1479409=>"1479497,1479536", 22776163=>"22776365,22776355", 23139169=>"23139393,23139383", 4284967=>"4285015,4285032", 826360=>"4412400,4390193", 1688952=>"1692380,1692410", 18326057=>"18326203,18326165", 920730=>"4410722,4390362", 2826746=>"9068983,9067981", 1332010=>"4413970,4413874", 1693006=>"1693094,1693124", 1721146=>"1721232,1721262", 22777437=>"22777619,22777609", 898520=>"4397767,4390155", 1178513=>"1178789,1178778", 22573355=>"22573403,22792858", 814335=>"4410752,4389286", 1138615=>"1139572,1139561", 4365469=>"4365517,4365534", 17433987=>"17513776,17513766", 886495=>"4410825,4389574", 6474161=>"6474317,6474373", 1645806=>"1645892,1645922", 4336057=>"4336116,4336073", 1198045=>"1198133,1198062", 847635=>"4412285,4390604", 23222989=>"23223333,23223323", 23154649=>"23154853,23154843", 23052675=>"23052723,23052745", 1172150=>"1172426,1172415", 22720992=>"22720994,22721156", 3041216=>"3042264,3042253", 1519311=>"4411327,4390719", 22785111=>"22785293,22785283", 818960=>"4410820,3029510", 22781259=>"22781441,22781431", 913330=>"4411080,4410987", 835610=>"4410927,4389117", 1187293=>"1187985,1187974", 1260290=>"4412045,4389258", 891120=>"4410617,4390438", 1179220=>"1179318,1179247", 22992477=>"22992630,22992686", 1766040=>"1766326,1766315", 1321093=>"4413828,4413792", 4514648=>"4514852,4514842", 1523936=>"22863862,4390623", 1626982=>"1627130,1627169", 862445=>"4412090,4388999", 823585=>"4397717,4389418", 840235=>"4410948,4389120", 4289261=>"4289309,4289326", 1690398=>"1691676,1691706", 22779318=>"22779500,22779490", 5002074=>"8791506,8791500", 2569304=>"8690247,8690241", 917955=>"4412405,4390343", 1172857=>"1173133,1173122", 11483588=>"11483804,11483794", 4999998=>"5000199,5000189", 811560=>"4411010,4386646", 5972470=>"5972616,5972578", 4981138=>"4981335,4981325", 2821058=>"13892103,20787150", 2128211=>"2129997,2129986", 6215412=>"8791334,8791298", 828210=>"4411207,4386640", 1132692=>"1132968,1133067", 844860=>"19073779,4386912", 900370=>"4412395,4389412", 5897900=>"20044462,20043829", 22786992=>"22787174,22787164", 2894826=>"2894916,2894955", 22571721=>"22571769,22735463", 816185=>"4411752,4390598", 23140250=>"23140424,23140414", 932765=>"4397722,4389655", 1128807=>"1129644,6640033", 22783140=>"22783412,22783402", 22775536=>"22775718,22775708", 2562976=>"7726482,7724213", 832835=>"4411817,4390340", 888345=>"4412145,4390396", 4515189=>"7725690,7725204", 22776810=>"22776992,22776982", 4841714=>"4841762,4845437", 4857828=>"10590699,10590693", 1521161=>"4410767,4390687", 937390=>"4410795,4410789", 6246001=>"22988919,6246174", 1189980=>"1190068,1189997", 820810=>"4412355,4386886", 23140018=>"23140192,23140182", 915180=>"4410692,4389687", 892970=>"6680654,4389386", 1650874=>"1651070,1651100", 23052282=>"23052330,23052352", 16656864=>"22874522,22874519", 1322306=>"4413243,4413237", 23131309=>"23131573,23131563", 1652382=>"1652580,1658400", 381526=>"381756,381691", 1525786=>"20080283,19968611", 4783728=>"8691180,4783924", 22784484=>"22784666,22784656", 825435=>"4412040,4386877", 1328371=>"4413787,4413761", 22780632=>"22780814,22780804", 919805=>"4412660,4390368", 22788873=>"22789055,22789045", 9114877=>"9115130,9115120", 1143150=>"1143238,1143167", 345850=>"346077,346013", 1645047=>"1645193,1645223", 23139786=>"23139960,23139950", 929990=>"4410687,4389149", 813410=>"4411747,4386729", 830060=>"4410907,2914832", 6638357=>"6639477,6639528", 5510010=>"5510058,5510621", 885570=>"4411107,4389568", 22778691=>"22778873,22778863", 4730968=>"8690908,8690902", 22572968=>"22573146,22735444", 17499661=>"17500364,17500354", 934615=>"6678013,4389354", 1139769=>"1139857,1139786", 23277909=>"23278153,23278143", 1518386=>"4410953,4390722", 23139554=>"23139728,23139718", 1628802=>"1628890,1628929", 1174978=>"1175254,1175243", 1651683=>"1651769,1651799", 834685=>"4410805,4388967", 1624079=>"1624167,1624206"}

class Hydronet
  include Net

  HOST        = "www.hydronet.be"
  PATH        = "/wiskiwebpublic/tsdata.php"
  DATA_FORMAT = "TEXT"
  DATE_FORMAT = "%Y%m%e000000"

  def initialize(vlid)
    @vlid = vlid
  end

  def water_level
    page = get_page
    extract_water_level_from_page(page)
  end

  private

  def get_page
    uri = build_uri
    HTTP.get(uri)
  end

  def extract_water_level_from_page(page)
    lines           = page.split("\n")
    last_level_line = lines.select{ |line| line.include?("unchecked") && !line.include?("incomplete") }.last
    level           = last_level_line ? last_level_line.split("\t")[1] : nil
    level.to_f
  end

  def build_uri
    query = URI.encode_www_form(build_query)
    URI::HTTP.build(:host => HOST, :path => PATH, :query => query)
  end

  def build_query
    today    = Date.today
    tomorrow = today + 1
    {
      dataformat:  DATA_FORMAT,
      ts_str_from: today.strftime(DATE_FORMAT),
      ts_str_to:   tomorrow.strftime(DATE_FORMAT),
      vlid:        @vlid
    }
  end
end

STATIONS.each do |stationident, vlid|
  puts stationident
  level = Hydronet.new(vlid).water_level
  ScraperWiki::save_sqlite([:stationident], {:stationident => stationident, :level => level, :recorded_at => DateTime.now.iso8601})
end