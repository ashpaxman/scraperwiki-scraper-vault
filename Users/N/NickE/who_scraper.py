###########################################################################################
# We use a ScraperWiki library called pdftoxml to scrape PDFs.
# This is an example of scraping a simple PDF.
###########################################################################################

import scraperwiki
import urllib2
import lxml.etree

urls = ['http://www.who.int/tobacco/surveillance/policy/country_profile/afg.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/alb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/dza.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/and.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ago.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/atg.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/arg.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/arm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/aus.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/aut.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/aze.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bhs.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bhr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bgd.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/brb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/blr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bel.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/blz.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ben.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/btn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bih.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bwa.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bra.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/brn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bgr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bfa.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bdi.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/khm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cmr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/can.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cpv.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/caf.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tcd.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/chl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/chn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/col.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/com.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cog.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cok.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cri.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/civ.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/hrv.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cub.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cyp.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cze.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/prk.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cod.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/dek.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/dji.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/dma.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/dom.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ecu.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/egy.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/slv.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gnq.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/eri.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/est.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/eth.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gab.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gambia.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/geo.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/deu.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gha.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/grc.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/grd.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gtm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gin.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gnb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/guy.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/hti.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/hnd.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/hun.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/isl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ind.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/idn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/irn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/irq.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/irl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/isr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ita.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/jam.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/jpn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/jor.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/kaz.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ken.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/kir.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/kwt.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/kgz.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lao.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lva.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lbn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lso.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lbr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lby.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ltu.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lux.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mdg.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mwi.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mys.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mdv.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mli.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mlt.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mhl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mrt.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mus.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mex.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/fsm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mco.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mng.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mne.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mar.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/moz.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mmr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nam.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nru.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/npl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nld.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nzl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nic.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ner.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nga.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/niu.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nor.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/pak.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/plw.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/pan.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/png.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/pry.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/per.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/phl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/pol.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/prt.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/kor.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mda.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/rou.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/rus.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/rwa.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/kna.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lca.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/vct.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/wsm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/smr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/stp.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/sau.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/sen.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/srb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/syc.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/sle.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/sgp.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/svk.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/svn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/slb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/som.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/zaf.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/esp.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lka.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/sdn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/sur.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/swz.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/swe.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/che.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/syr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tjk.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tha.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mkd.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tls.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tgo.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ton.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tto.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tun.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tur.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tkm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tuv.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/uga.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ukr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/are.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gbr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tza.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/usa.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ury.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/uzb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/vut.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ven.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/vnm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/yem.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/zmb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/zwe.pdf']
for url in urls:
    
    pdfdata = urllib2.urlopen(url).read()
    print "The pdf file has %d bytes" % len(pdfdata)
    
    xmldata = scraperwiki.pdftoxml(pdfdata)
    print "After converting to xml it has %d bytes" % len(xmldata)
    print "The first 2000 characters are: ", xmldata[:2000]
    
    root = lxml.etree.fromstring(xmldata)
    pages = list(root)
    
    print "The pages are numbered:", [ page.attrib.get("number")  for page in pages ]
    
    
    # this function has to work recursively because we might have "<b>Part1 <i>part 2</i></b>"
    def gettext_with_bi_tags(el):
        res = [ ]
        if el.text:
            res.append(el.text)
        for lel in el:
            res.append("<%s>" % lel.tag)
            res.append(gettext_with_bi_tags(lel))
            res.append("</%s>" % lel.tag)
            if el.tail:
                res.append(el.tail)
        return "".join(res)
    
    # print the first hundred text elements from the first page
    textels =[]
    
    page0 = pages[5]
    for el in list(page):
        if el.tag == "text":
            text = gettext_with_bi_tags(el)
            textels.append(text)
    
    country = textels[0].split('Country Profile: ')[1]
    price = textels[textels.index('In US$ at official exchange rate ') + 4]    

    price = textels[63].strip()
    if price == ". . .":
        price = 'na'
    print country, price    

    data = {}
    data['country'] = country
    data['price'] = price
    scraperwiki.sqlite.save(unique_keys=["country"], data=data)

###########################################################################################
# We use a ScraperWiki library called pdftoxml to scrape PDFs.
# This is an example of scraping a simple PDF.
###########################################################################################

import scraperwiki
import urllib2
import lxml.etree

urls = ['http://www.who.int/tobacco/surveillance/policy/country_profile/afg.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/alb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/dza.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/and.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ago.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/atg.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/arg.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/arm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/aus.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/aut.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/aze.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bhs.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bhr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bgd.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/brb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/blr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bel.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/blz.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ben.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/btn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bih.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bwa.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bra.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/brn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bgr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bfa.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/bdi.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/khm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cmr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/can.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cpv.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/caf.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tcd.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/chl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/chn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/col.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/com.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cog.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cok.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cri.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/civ.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/hrv.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cub.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cyp.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cze.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/prk.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/cod.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/dek.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/dji.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/dma.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/dom.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ecu.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/egy.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/slv.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gnq.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/eri.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/est.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/eth.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gab.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gambia.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/geo.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/deu.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gha.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/grc.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/grd.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gtm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gin.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gnb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/guy.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/hti.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/hnd.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/hun.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/isl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ind.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/idn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/irn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/irq.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/irl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/isr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ita.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/jam.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/jpn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/jor.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/kaz.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ken.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/kir.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/kwt.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/kgz.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lao.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lva.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lbn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lso.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lbr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lby.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ltu.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lux.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mdg.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mwi.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mys.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mdv.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mli.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mlt.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mhl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mrt.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mus.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mex.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/fsm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mco.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mng.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mne.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mar.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/moz.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mmr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nam.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nru.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/npl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nld.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nzl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nic.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ner.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nga.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/niu.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/nor.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/pak.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/plw.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/pan.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/png.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/pry.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/per.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/phl.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/pol.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/prt.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/kor.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mda.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/rou.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/rus.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/rwa.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/kna.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lca.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/vct.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/wsm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/smr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/stp.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/sau.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/sen.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/srb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/syc.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/sle.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/sgp.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/svk.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/svn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/slb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/som.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/zaf.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/esp.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/lka.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/sdn.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/sur.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/swz.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/swe.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/che.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/syr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tjk.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tha.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/mkd.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tls.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tgo.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ton.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tto.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tun.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tur.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tkm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tuv.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/uga.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ukr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/are.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/gbr.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/tza.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/usa.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ury.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/uzb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/vut.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/ven.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/vnm.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/yem.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/zmb.pdf','http://www.who.int/tobacco/surveillance/policy/country_profile/zwe.pdf']
for url in urls:
    
    pdfdata = urllib2.urlopen(url).read()
    print "The pdf file has %d bytes" % len(pdfdata)
    
    xmldata = scraperwiki.pdftoxml(pdfdata)
    print "After converting to xml it has %d bytes" % len(xmldata)
    print "The first 2000 characters are: ", xmldata[:2000]
    
    root = lxml.etree.fromstring(xmldata)
    pages = list(root)
    
    print "The pages are numbered:", [ page.attrib.get("number")  for page in pages ]
    
    
    # this function has to work recursively because we might have "<b>Part1 <i>part 2</i></b>"
    def gettext_with_bi_tags(el):
        res = [ ]
        if el.text:
            res.append(el.text)
        for lel in el:
            res.append("<%s>" % lel.tag)
            res.append(gettext_with_bi_tags(lel))
            res.append("</%s>" % lel.tag)
            if el.tail:
                res.append(el.tail)
        return "".join(res)
    
    # print the first hundred text elements from the first page
    textels =[]
    
    page0 = pages[5]
    for el in list(page):
        if el.tag == "text":
            text = gettext_with_bi_tags(el)
            textels.append(text)
    
    country = textels[0].split('Country Profile: ')[1]
    price = textels[textels.index('In US$ at official exchange rate ') + 4]    

    price = textels[63].strip()
    if price == ". . .":
        price = 'na'
    print country, price    

    data = {}
    data['country'] = country
    data['price'] = price
    scraperwiki.sqlite.save(unique_keys=["country"], data=data)

