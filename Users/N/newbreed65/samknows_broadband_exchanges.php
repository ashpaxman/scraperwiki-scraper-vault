<?php
require 'scraperwiki/simple_html_dom.php';
    //  The following is a list of Exchange SAUIDs gleaned from SamKnows
$codes = array("SWLAK","SWLAS","SWLCA","SWLDR","SWLDV","SWLGC","SWLHY","SWLJ","SWLJV","SWLJZ","SWLKB","SWLKD","SWLKY","SWLLD","SWLLF","SWLLG","SWLLM","SWLLO","SWLLP","SWLLR","SWLLU","SWLLW","SWLNI","SWLNN","SWLPI","SWLQW","SWLY","SWLYA","SWLYJ","SWLYW","SWMAD","SWMAL","SWMDE","SWMDX","SWMES","SWMF","SWMGR","SWMGX","SWMLZ","SWMMN","SWMMV","SWMNF","SWMT_EX","SWMU","SWMWY","SWMYE","SWMYG","SWMYS","SWMYU","SWNB","SWNBI","SWNDO","SWNDU","SWNE_CH","SWNE_EX","SWNEN","SWNES","SWNM","SWNNA","SWNSN","SWNTD","SWOAG","SWPBL","SWPBM","SWPDU","SWPDW","SWPEC","SWPEK","SWPEU","SWPEV","SWPHX","SWPM","SWPMQ","SWPN","SWPND","SWPOM","SWPP","SWPQS","SWPRU","SWPTB","SWPTH","SWPTM","SWPTY","SWPUN","SWPYH","SWRAG","SWRDA","SWRDX","SWRHA","SWRHR","SWRLS","SWRRY","SWRSO","SWRSV","SWRTH","SWRVH","SWRWI","SWSAS","SWSAW","SWSDV","SWSFJ","SWSKJ","SWSKU","SWSMX","SWSNI","SWSSQ","SWSVB","SWSX","SWSZX","SWTAF","SWTAJ","SWTAT","SWTB","SWTDE","SWTDU","SWTEK","SWTEZ","SWTFA","SWTFS","SWTLL","SWTLU","SWTR","SWTRF","SWTRH","SWTSA","SWTUC","SWUAH","SWUAZ","SWUCW","SWUGI","SWUGU","SWUHN","SWUTK","SWUWN","SWVLD","SWVVW","SWWCP","SWWHT","SWWJK","SWWXC","SWXNH","SWXSX","SWXTP","SWXUU","SWYBL","SWYDU","SWYRO","SWYYN","THEAR","THH","THHC","THHD","THHDY","THHE","THHF","THHH","THHM","THHN","THHRJ","THHS","THHT","THHW","THIN","THIP","THKB","THKC","THKE","THLG","THLL","THLM","THLP","THLSN","THM","THMD","THML","THMO","THMS","THMSD","THNB","THNE","THNL","THNU","THOH","THOK","THOL","THOV","THP","THPC","THPM","THPS","THRD","THRG","THRO","THS","THSBN","THSCR","THSE","THSL","THSL_UD","THSPD","THT","THTAD","THTF","THTG","THTH","THTI","THTT","THTV","THUB","THWA","THWDY","THWI","THWK","THWL","THWM","THWN","THWO","THWP","THWR","THWT","THWTH","THWY","THY","WEWHAM","WEWLOR","WEWMAI","WEWMAR","WEWMAY","WEWNPN","WEWPAD","WEWPRI","WEWSOH","WMCIT","WMHAM","WMHAN","WMHAR","WMHAS","WMHAV","WMHCH","WMHIL","WMHIM","WMHOL","WMHSW","WMHX","WMINK","WMIPN","WMIPS","WMKD","WMKDG","WMKEM","WMKLT","WMKNI","WMLEE","WMLEI","WMLIT","WMLON","WMLOW","WMMAD","WMMAL","WMMFD","WMMIC","WMMTL","WMNAN","WMNEW","WMOAK","WMOMB","WMONE","WMPAX","WMPEO","WMPER","WMPKR","WMPOW","WMRCR","WMRID","WMRJ","WMROK","WMROM","WMRUD","WMRUG","WMSAN","WMSBH","WMSEI","WMSEV","WMSHB","WMSMA","WMSPA","WMSPE","WMSRK","WMSTA","WMSTD","WMSTJ","WMSTK","WMSTO","WMSTP","WMSTU","WMSUC","WMSWY","WMTEA","WMTRE","WMUPS","WMUSN","WMUTT","WMUUS","WMWAR","WMWAT","WMWES","WMWET","WMWHE","WMWHS","WMWIC","WMWLN","WMWLY","WMWOO","WMWR","WMWRK","WMWTM","WMWYB","WMWYC","WMYAR","WNHAE","WNHAM","WNHAN","WNHAR","WNHAT","WNHAW","WNHAY","WNHCP","WNHER","WNHL","WNHLN","WNHMR","WNHOD","WNHOL","WNHR","WNHUN","WNHUX","WNHW","WNIB","WNIV","WNKEL","WNKER","WNKIN","WNKNG","WNKNI","WNKNO","WNKT","WNKYR","WNLAD","WNLAN","WNLAR","WNLBD","WNLBG","WNLBH","WNLBR","WNLBW","WNLC","WNLDA","WNLDC","WNLDD","WNLDF","WNLDG","WNLDO","WNLEA","WNLED","WNLEI","WNLEO","WNLEY","WNLFF","WNLFN","WNLFS","WNLFU","WNLGD","WNLGF","WNLGG","WNLGL","WNLGN","WNLGO","WNLGW","WNLGY","WNLIN","WNLIT","WNLMD","WNLMR","WNLMY","WNLN","WNLNF","WNLNO","WNLNS","WNLNY","WNLON","WNLR","WNLRD","WNLSF","WNLSN","WNLST","WNLTH","WNLTN","WNLU","WNLUD","WNLVL","WNLW","WNLWA","WNLWN","WNLWW","WNLYD","WNLYI","WNLYO","WNM","WNMAC","WNMAN","WNMAP","WNMAR","WNMB","WNMD","WNMDL","WNMEI","WNMFB","WNMIC","WNMM","WNMOC","WNMOE","WNMON","WNMOS","WNMSB","WNMSL","WNMT","WNMUC","WNMUN","WNMW","WNNAN","WNNBG","WNNBR","WNNCL","WNNEB","WNNEF","WNNN","WNNOR","WNNOW","WNNP","WNNR","WNNTP","WNOAK","WNOC","WNOOD","WNOSW","WNPAI","WNPAN","WNPBK","WNPCH","WNPCO","WNPDD","WNPEB","WNPEF","WNPEG","WNPEM","WNPEN","WNPG","WNPIP","WNPMN","WNPNL","WNPNN","WNPNR","WNPON","WNPOR","WNPRD","WNPRE","WNPRG","WNPRL","WNPRS","WNPTD","WNPTW","WNPWL","WNQH","WNRAY","WNRC","WNRE","WNRHD","WNRHU","WNRIW","WNRM","WNRNR","WNROS","WNROW","WNRST","WNRUA","WNRUT","WNRWX","WNRYT","WNSA","WNSAM","WNSAU","WNSEA","WNSEI","WNSHA","WNSHI","WNSSM","WNSSN","WNSTE","WNSTI","WNSW","WNSY","WNTAL","WNTAR","WNTFG","WNTH","WNTHL","WNTHR","WNTIL","WNTRA","WNTRB","WNTRG","WNTRN","WNTRR","WNTRU","WNTRW","WNTRY","WNTUD","WNTV","WNTW","WNTYG","WNTYN","WNTYW","WNUB","WNUM","WNUP","WNVAL","WNWA","WNWCH","WNWEL","WNWEM","WNWEO","WNWET","WNWIG","WNWIT","WNWOM","WNWOR","WNWPL","WNWTN","WNWUL","WNWX","WNWXL","WNWXN","WNYA","WNYO","WRKGDN","WRNELMS","WRPGRN","WRPIM","WRSKEN","WRSLO","WRSTHBK","WRVAUX","WRWHI","WRWKEN","WRWMIN","WSHAM","WSHAU","WSHEL","WSHOL","WSIBR","WSINN","WSINS","WSINV","WSIRS","WSIRV","WSJOB","WSJOH","WSJOP","WSJUR","WSKBN","WSKET","WSKGE","WSKIA","WSKIB","WSKIC","WSKID","WSKIE","WSKIF","WSKIG","WSKII","WSKIK","WSKIL","WSKIM","WSKIN","WSKIO","WSKIP","WSKIR","WSKIU","WSKIW","WSKIY","WSKKC","WSKKD","WSKKE","WSKKF","WSKKL","WSKKN","WSKKO","WSKKR","WSKKT","WSKKZ","WSKLM","WSKLN","WSKRK","WSLAA","WSLAB","WSLAH","WSLAK","WSLAL","WSLAM","WSLAN","WSLAR","WSLAU","WSLEA","WSLED","WSLEN","WSLES","WSLEW","WSLEX","WSLID","WSLIS","WSLOA","WSLOC","WSLOD","WSLOE","WSLOG","WSLOH","WSLOI","WSLON","WSLOS","WSLOT","WSLUI","WSLUS","WSMAB","WSMAC","WSMAH","WSMAR","WSMAU","WSMAY","WSMER","WSMIL","WSMIN","WSMIT","WSMOC","WSMOD","WSMOF","WSMON","WSMOS","WSMOT","WSMOU","WSMUI","WSNEA","WSNEB","WSNEC","WSNEG","WSNEL","WSNES","WSNEW","WSOBA","WSOCH","WSOLD","WSORM","WSPAI","WSPAL","WSPAN","WSPAR","WSPAT","WSPEN","WSPIN","WSPIR","WSPOA","WSPOC","WSPOE","WSPOL","WSPOP","WSPOR","WSPOS","WSPOW","WSPRE","WSPRO","WSPTH","WSPTN","WSREN","WSRHU","WSRIN","WSROC","WSROT","WSRUT","WSSAL","WSSAN","WSSAQ","WSSCA","WSSCO","WSSHE","WSSHI","WSSKI","WSSKL","WSSLI","WSSOE","WSSOK","WSSOR","WSSPR","WSSTD","WSSTE","WSSTN","WSSTO","WSSTR","WSSTT","WSSTU","WSSTW","WSSYM","WSTAB","WSTAH","WSTAR","WSTAT","WSTAY","WSTHL","WSTHO","WSTIG","WSTIN","WSTIR","WSTOB","WSTOD","WSTOR","WSTOW","WSTRO","WSTUR","WSTWE","WSTWY","WSTYN","WSUDD","WSULV","WSUPL","WSWAT","WSWEK","WSWEM","WSWES","WSWHB","WSWHH","WSWHI","WSWIG","WSWIS","WWHARB","WWHART","WWHATH","WWHAWK","WWHAYL","WWHBCK","WWHBCM","WWHCRX","WWHELE","WWHELS","WWHEMY","WWHENL","WWHOLB","WWHOLF","WWHOLN","WWHOLS","WWHONI","WWHTOR","WWILCH","WWILFR","WWILMI","WWINST","WWIPPL","WWISLE","WWIVYB","WWKENN","WWKENT","WWKGWR","WWKILK","WWKKWL","WWKNGB","WWKSTM","WWLAND","WWLANR","WWLAPF","WWLAUN","WWLDOW","WWLEED","WWLIFT","WWLISK","WWLLAW","WWLODD","WWLOOE","WWLOST","WWLPRT","WWLSTL","WWLSUT","WWLTRE","WWLUPP","WWLVET","WWLWDN","WWLYDF","WWLYME","WWLYNT","WWMABT","WWMARA","WWMARK","WWMART","WWMAWG","WWMBSH","WWMCAN","WWMDAM","WWMEVA","WWMILV","WWMINE","WWMITC","WWMLBK","WWMMAG","WWMODY","WWMORT","WWMORW","WWMOUS","WWMPRT","WWMSMT","WWMTON","WWMTVY","WWMULL","WWNABB","WWNANP","WWNCAD","WWNCUR","WWNCYR","WWNETH","WWNEWQ","WWNFER","WWNMOL","WWNPTN","WWNPWI","WWNTAM","WWNTAW","WWNTCY","WWOAKF","WWOKEH","WWOSMY","WWOSTN","WWPADS","WWPAIG","WWPAR","WWPCMB","WWPENZ","WWPERR","WWPINH","WWPIPE","WWPISA","WWPLRN","WWPOLP","WWPORL","WWPOST","WWPOUN","WWPRAZ","WWPREA","WWPRIN","WWPRYN","WWPSCO","WWPSTK","WWPTON","WWPTRE","WWPTWN","WWPURI","WWPYTH","WWRACK","WWREDR","WWRILL","WWROBO","WWROCH","WWRUMF","WWSAGN","WWSALC","WWSALT","WWSAMP","WWSAUS","WWSBNT","WWSBUD","WWSBUR","WWSCAN","WWSCHD","WWSCIL","WWSCLM","WWSCOL","WWSDAY","WWSDOM","WWSEAT","WWSENN","WWSFLM","WWSGAB","WWSGEN","WWSGER","WWSHAL","WWSHAU","WWSHEB","WWSHER","WWSHIP","WWSHIR","WWSIDB","WWSIDM","WWSILV","WWSIVE","WWSJUS","WWSKEV","WWSMAB","WWSMAR","WWSMER","WWSMOL","WWSMWG","WWSMWS","WWSOME","WWSOWT","WWSPAX","WWSPET","WWSTAL","WWSTAR","WWSTAV","WWSTEN","WWSTIC","WWSTIT","WWSTOC","WWSTOG","WWSTUD","WWSUTT","WWSWIM","WWTAUN","WWTAVI","WWTEDB","WWTEIG","WWTEMP","WWTHRE","WWTIMB","WWTINT","WWTIVE","WWTLIZ","WWTOPS","WWTORQ","WWTORR","WWTORX","WWTOTN","WWTPNT","WWTREB","WWTREG","WWTRES","WWTRUR","WWUPOT","WWVERY","WWWADE","WWWASH","WWWBAY","WWWCKR","WWWDGT","WWWDWN","WWWEEK","WWWELL","WWWEMB","WWWFRD","WWWHEA","WWWHIM","WWWILL","WWWILM","WWWINC","WWWITH","WWWIVE","WWWKLH","WWWMON","WWWMOR","WWWOOD","WWWOOL","WWWSHM","WWWZOY","WWYEAL","WWYELV","WWYEOV","WWYETM","WWZELA");

foreach($codes as $code) {
    echo "Loading " . $code . "...";
    $html = scraperWiki::scrape("http://www.samknows.com/broadband/exchange/" . $code);
    echo "Loaded";
    $dom = new simple_html_dom();
    $dom->load($html);
    foreach ($dom->find("div.item-content tr") as $row) {
      $headers = $row->find("th");
      $columns = $row->find("td");
      if (preg_match("/Postcode/", $headers[0]->plaintext)) {
        echo $code . ": " . $columns[0]->plaintext;
        scraperwiki::save(array("code"), array("code"=>$code, "postcode"=>$columns[0]->plaintext));
        break;
      }
   }
}
?>