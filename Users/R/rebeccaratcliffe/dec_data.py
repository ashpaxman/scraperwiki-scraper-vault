import scraperwiki

# Blank Python
import scraperwiki

# Blank Python

import scraperwiki

# Blank Python
import scraperwiki

# Blank Python

# typical URL is http://www.london-gazette.co.uk/id/issues/60112/notices/1568529
# list of URLs collected by scraper at https://scraperwiki.com/scrapers/bankruptcies/
# Downloaded as CSV and codes extracted in Google Docs by using =RIGHT(A2, 7)
# Cycle through a list of those codes, created by using the =JOIN formula in Google Docs

#If you want to understand this scraper - start at the bottom where it says 'base_url'

import scraperwiki
#import urlparse
import lxml.html

#Create a function called 'scrape_table' which is called in the function 'scrape_page' below
#The 'scrape_page' function also passed the contents of the page to this function as 'root'
def scrape_table(root):
    #Use cssselect to find the contents of a particular HTML tag, and put it in a new object 'divdata'
    #there's more than one div, so we need to specify the class="Data", represented by the full stop
    divdata = root.cssselect("div.Data")
    for pars in divdata:
        #Create a new empty record
        record = {}
        #Assign the contents of <td> to a new object called 'table_cells'
        lines = pars.cssselect("p")
        spans = pars.cssselect("p span")
        #If there's anything
#TO ADD: AN ELSE TO ADDRESS DATE/URLCODE WHICH ARE 'OUT OF RANGE' ON SOME PAGES        
        if lines:
            #Put the contents of the first <p> into a record in the column 'pubdate'
            record['pubdate'] = spans[0].text
            record['noticecode'] = spans[1].text
            record['name'] = spans[2].text
            record['address'] = lines[4].text
            record['DOB'] = lines[5].text
            record['description'] = lines[6].text
            record['court'] = lines[7].text
            record['dateofpetition'] = lines[8].text
            record['dateoforder'] = lines[9].text
            record['timeoforder'] = lines[10].text
            record['petitionby'] = lines[11].text
            record['receiver'] = spans[2].text
#            record['date'] = lines[13].text
#            record['urlcode'] = lines[14].text
            record['ID'] = item
            print record, '------------'
            #Save in the SQLite database, with the ID code to be used as the unique reference
            scraperwiki.sqlite.save(["ID"], record)
        


#this creates a new function and (re)names whatever parameter is passed to it - i.e. 'next_link' below - as 'url'
def scrape_page(url):
    #now 'url' is scraped with the scraperwiki library imported above, and the contents put into a new object, 'html'
    html = scraperwiki.scrape(url)
    print html
    #now we use the lxml.html function imported above to convert 'html' into a new object, 'root'
    root = lxml.html.fromstring(html)
    #now we call another function on root, which we write - above
    scrape_table(root)

#START HERE: This is the part of the URL which all our pages share
base_url = 'http://www.london-gazette.co.uk/issues/'
#And these are the numbers which we need to complete that URL to make each individual URL
#This array has been compiled using the =JOIN formula in Google Docs on a column of URL codes
codes =['59999/notices/1497261', '59999/notices/1497286', '59999/notices/1497301', '59999/notices/1497270', '59999/notices/1497280', '59999/notices/1497328', '59999/notices/1497238', '59999/notices/1497219', '59999/notices/1497178', '59999/notices/1497235', '59999/notices/1497236', '59999/notices/1497170', '59999/notices/1497193', '59999/notices/1497184', '59999/notices/1497217', '59999/notices/1497308', '59999/notices/1497324', '59999/notices/1497206', '59999/notices/1497168', '59999/notices/1497162', '59999/notices/1497297', '59999/notices/1497279', '59999/notices/1497284', '59999/notices/1497315', '59999/notices/1497157', '59999/notices/1497248', '59999/notices/1497198', '59999/notices/1497222', '59999/notices/1497298', '59999/notices/1497177', '59999/notices/1497196', '59999/notices/1497300', '59999/notices/1497283', '59999/notices/1497212', '59999/notices/1497260', '59999/notices/1497182', '59999/notices/1497224', '59999/notices/1497221', '59999/notices/1497201', '59999/notices/1497306', '59999/notices/1497241', '59999/notices/1497259', '59999/notices/1497290', '59999/notices/1497188', '59999/notices/1497200', '59999/notices/1497231', '59999/notices/1497174', '59999/notices/1497264', '59999/notices/1497273', '59999/notices/1497257', '59999/notices/1497314', '59999/notices/1497313', '59999/notices/1497233', '59999/notices/1497277', '59999/notices/1497185', '59999/notices/1497218', '59999/notices/1497189', '59999/notices/1497244', '59999/notices/1497282', '59999/notices/1497287', '59999/notices/1497255', '59999/notices/1497254', '59999/notices/1497275', '59999/notices/1497327', '59999/notices/1497329', '59999/notices/1497237', '59999/notices/1497180', '59999/notices/1497195', '59999/notices/1497239', '59999/notices/1497272', '59999/notices/1497181', '59999/notices/1497288', '59999/notices/1497191', '59999/notices/1497179', '59999/notices/1497258', '59999/notices/1497285', '59999/notices/1497232', '59999/notices/1497156', '59999/notices/1497234', '59999/notices/1497268', '59999/notices/1497316', '59999/notices/1497292', '59999/notices/1497197', '59999/notices/1497208', '59999/notices/1497228', '60000/notices/1498089', '60000/notices/1498113', '60000/notices/1498118', '60000/notices/1498117', '60000/notices/1498148', '60000/notices/1498168', '60000/notices/1498208', '60000/notices/1498169', '60000/notices/1498136', '60000/notices/1498162', '60000/notices/1498196', '60000/notices/1498192', '60000/notices/1498193', '60000/notices/1498088', '60000/notices/1498125', '60000/notices/1498104', '60000/notices/1498129', '60000/notices/1498098', '60000/notices/1498200', '60000/notices/1498216', '60000/notices/1498083', '60000/notices/1498145', '60000/notices/1498100', '60000/notices/1498203', '60000/notices/1498093', '60000/notices/1498187', '60000/notices/1498084', '60000/notices/1498094', '60000/notices/1498076', '60000/notices/1498226', '60000/notices/1498135', '60000/notices/1498206', '60000/notices/1498166', '60000/notices/1498115', '60000/notices/1498179', '60000/notices/1498180', '60000/notices/1498103', '60000/notices/1498120', '60000/notices/1498074', '60000/notices/1498227', '60000/notices/1498146', '60000/notices/1498150', '60000/notices/1498086', '60000/notices/1498190', '60000/notices/1498095', '60000/notices/1498182', '60000/notices/1498132', '60000/notices/1498177', '60000/notices/1498128', '60000/notices/1498189', '60000/notices/1498215', '60000/notices/1498138', '60000/notices/1498171', '60000/notices/1498109', '60000/notices/1498154', '60000/notices/1498210', '60000/notices/1498209', '60000/notices/1498165', '60000/notices/1498134', '60000/notices/1498075', '60000/notices/1498149', '60000/notices/1498174', '60000/notices/1498142', '60000/notices/1498119', '60000/notices/1498172', '60000/notices/1498167', '60000/notices/1498144', '60000/notices/1498143', '60000/notices/1498201', '60000/notices/1498175', '60000/notices/1498140', '60000/notices/1498122', '60000/notices/1498131', '60000/notices/1498194', '60000/notices/1498097', '60000/notices/1498121', '60000/notices/1498147', '60000/notices/1498228', '60000/notices/1498155', '60000/notices/1498160', '60000/notices/1498105', '60000/notices/1498116', '60000/notices/1498101', '60000/notices/1498156', '60000/notices/1498151', '60002/notices/1499086', '60002/notices/1499156', '60002/notices/1499128', '60002/notices/1499074', '60002/notices/1499035', '60002/notices/1499041', '60002/notices/1499088', '60002/notices/1499080', '60002/notices/1499066', '60002/notices/1499031', '60002/notices/1499069', '60002/notices/1499111', '60002/notices/1499112', '60002/notices/1499149', '60002/notices/1499097', '60002/notices/1499098', '60002/notices/1499132', '60002/notices/1499026', '60002/notices/1499084', '60002/notices/1499091', '60002/notices/1499051', '60002/notices/1499105', '60002/notices/1499024', '60002/notices/1499139', '60002/notices/1499017', '60002/notices/1499120', '60002/notices/1499085', '60002/notices/1499146', '60002/notices/1499119', '60002/notices/1499065', '60002/notices/1499141', '60002/notices/1499123', '60002/notices/1499083', '60002/notices/1499030', '60002/notices/1499129', '60002/notices/1499114', '60002/notices/1499107', '60002/notices/1499081', '60002/notices/1499049', '60002/notices/1499062', '60002/notices/1499021', '60002/notices/1499113', '60002/notices/1499136', '60002/notices/1499070', '60002/notices/1499118', '60002/notices/1499109', '60002/notices/1499137', '60002/notices/1499022', '60002/notices/1499133', '60002/notices/1499050', '60002/notices/1499019', '60002/notices/1499073', '60002/notices/1499148', '60002/notices/1499116', '60002/notices/1499063', '60002/notices/1499060', '60002/notices/1499093', '60002/notices/1499054', '60002/notices/1499039', '60002/notices/1499020', '60002/notices/1499056', '60002/notices/1499087', '60002/notices/1499078', '60002/notices/1499079', '60002/notices/1499092', '60002/notices/1499101', '60002/notices/1499048', '60002/notices/1499023', '60002/notices/1499145', '60002/notices/1499150', '60002/notices/1499090', '60002/notices/1499134', '60003/notices/1500010', '60003/notices/1499999', '60003/notices/1499912', '60003/notices/1499979', '60003/notices/1499930', '60003/notices/1499921', '60003/notices/1499959', '60003/notices/1499981', '60003/notices/1499992', '60003/notices/1499982', '60003/notices/1500008', '60003/notices/1500011', '60003/notices/1499939', '60003/notices/1499968', '60003/notices/1499972', '60003/notices/1499967', '60003/notices/1499909', '60003/notices/1499936', '60003/notices/1500006', '60003/notices/1499910', '60003/notices/1500007', '60003/notices/1500002', '60003/notices/1499945', '60003/notices/1499974', '60003/notices/1499989', '60003/notices/1499947', '60003/notices/1499954', '60003/notices/1499978', '60003/notices/1499984', '60003/notices/1499971', '60003/notices/1499918', '60003/notices/1499911', '60003/notices/1499994', '60003/notices/1499962', '60003/notices/1499933', '60003/notices/1499922', '60003/notices/1499937', '60003/notices/1499916', '60003/notices/1499976', '60003/notices/1499931', '60003/notices/1499932', '60003/notices/1499983', '60003/notices/1499942', '60003/notices/1500014', '60003/notices/1499998', '60003/notices/1499935', '60003/notices/1499925', '60003/notices/1499953', '60003/notices/1499908', '60003/notices/1499938', '60003/notices/1499919', '60003/notices/1499993', '60003/notices/1499920', '60003/notices/1499986', '60003/notices/1499969', '60003/notices/1500012', '60003/notices/1499973', '60003/notices/1499990', '60003/notices/1499980', '60004/notices/1500626', '60004/notices/1500628', '60004/notices/1500672', '60004/notices/1500734', '60004/notices/1500689', '60004/notices/1500677', '60004/notices/1500649', '60004/notices/1500684', '60004/notices/1500654', '60004/notices/1500751', '60004/notices/1500647', '60004/notices/1500704', '60004/notices/1500667', '60004/notices/1500688', '60004/notices/1500630', '60004/notices/1500707', '60004/notices/1500662', '60004/notices/1500666', '60004/notices/1500705', '60004/notices/1500636', '60004/notices/1500640', '60004/notices/1500680', '60004/notices/1500660', '60004/notices/1500657', '60004/notices/1500674', '60004/notices/1500676', '60004/notices/1500694', '60004/notices/1500721', '60004/notices/1500736', '60004/notices/1500746', '60004/notices/1500629', '60004/notices/1500698', '60004/notices/1500652', '60004/notices/1500697', '60004/notices/1500631', '60004/notices/1500637', '60004/notices/1500638', '60004/notices/1500720', '60004/notices/1500627', '60004/notices/1500699', '60004/notices/1500708', '60004/notices/1500742', '60004/notices/1500659', '60004/notices/1500738', '60004/notices/1500683', '60004/notices/1500745', '60004/notices/1500632', '60004/notices/1500678', '60004/notices/1500695', '60004/notices/1500732', '60004/notices/1500691', '60004/notices/1500645', '60004/notices/1500643', '60004/notices/1500639', '60004/notices/1500679', '60004/notices/1500661', '60004/notices/1500644', '60004/notices/1500703', '60004/notices/1500744', '60004/notices/1500714', '60004/notices/1500701', '60004/notices/1500653', '60004/notices/1500711', '60004/notices/1500718', '60004/notices/1500669', '60004/notices/1500670', '60005/notices/1502222', '60005/notices/1502221', '60005/notices/1502142', '60005/notices/1502175', '60005/notices/1502159', '60005/notices/1502214', '60005/notices/1502223', '60005/notices/1502163', '60005/notices/1502134', '60005/notices/1502133', '60005/notices/1502205', '60005/notices/1502230', '60005/notices/1502137', '60005/notices/1502127', '60005/notices/1502203', '60005/notices/1502211', '60005/notices/1502212', '60005/notices/1502139', '60005/notices/1502195', '60005/notices/1502229', '60005/notices/1502123', '60005/notices/1502204', '60005/notices/1502165', '60005/notices/1502144', '60005/notices/1502234', '60005/notices/1502140', '60005/notices/1502176', '60005/notices/1502179', '60005/notices/1502213', '60005/notices/1502151', '60005/notices/1502150', '60005/notices/1502220', '60005/notices/1502132', '60005/notices/1502158', '60005/notices/1502177', '60005/notices/1502136', '60005/notices/1502216', '60005/notices/1502172', '60005/notices/1502190', '60005/notices/1502154', '60005/notices/1502155', '60005/notices/1502135', '60005/notices/1502243', '60005/notices/1502242', '60005/notices/1502173', '60005/notices/1502183', '60005/notices/1502130', '60005/notices/1502149', '60005/notices/1502184', '60005/notices/1502181', '60005/notices/1502187', '60005/notices/1502206', '60005/notices/1502166', '60005/notices/1502122', '60005/notices/1502239', '60005/notices/1502145', '60005/notices/1502215', '60005/notices/1502174', '60005/notices/1502233', '60005/notices/1502238', '60005/notices/1502217', '60005/notices/1502250', '60005/notices/1502245', '60005/notices/1502156', '60005/notices/1502180', '60005/notices/1502189', '60005/notices/1502193', '60005/notices/1502185', '60005/notices/1502188', '60005/notices/1502251', '60007/notices/1503191', '60007/notices/1503222', '60007/notices/1503145', '60007/notices/1503236', '60007/notices/1503252', '60007/notices/1503240', '60007/notices/1503156', '60007/notices/1503170', '60007/notices/1503231', '60007/notices/1503208', '60007/notices/1503203', '60007/notices/1503202', '60007/notices/1503276', '60007/notices/1503196', '60007/notices/1503141', '60007/notices/1503248', '60007/notices/1503213', '60007/notices/1503268', '60007/notices/1503224', '60007/notices/1503140', '60007/notices/1503146', '60007/notices/1503182', '60007/notices/1503151', '60007/notices/1503148', '60007/notices/1503241', '60007/notices/1503201', '60007/notices/1503235', '60007/notices/1503266', '60007/notices/1503162', '60007/notices/1503239', '60007/notices/1503150', '60007/notices/1503254', '60007/notices/1503154', '60007/notices/1503229', '60007/notices/1503270', '60007/notices/1503186', '60007/notices/1503228', '60007/notices/1503142', '60007/notices/1503245', '60007/notices/1503242', '60007/notices/1503143', '60007/notices/1503221', '60007/notices/1503190', '60007/notices/1503271', '60007/notices/1503205', '60007/notices/1503159', '60007/notices/1503251', '60007/notices/1503167', '60007/notices/1503160', '60007/notices/1503184', '60007/notices/1503189', '60007/notices/1503181', '60007/notices/1503223', '60007/notices/1503255', '60007/notices/1503200', '60007/notices/1503275', '60007/notices/1503188', '60007/notices/1503274', '60007/notices/1503246', '60007/notices/1503244', '60007/notices/1503217', '60007/notices/1503165', '60007/notices/1503147', '60007/notices/1503204', '60007/notices/1503259', '60007/notices/1503192', '60007/notices/1503155', '60007/notices/1503262', '60007/notices/1503278', '60007/notices/1503218', '60007/notices/1503194', '60007/notices/1503183', '60007/notices/1503211', '60007/notices/1503214', '60007/notices/1503226', '60007/notices/1503264', '60007/notices/1503277', '60007/notices/1503152', '60007/notices/1503253', '60007/notices/1503139', '60007/notices/1503261', '60007/notices/1503265', '60007/notices/1503210', '60007/notices/1503209', '60007/notices/1503238', '60008/notices/1504105', '60008/notices/1504209', '60008/notices/1504093', '60008/notices/1504095', '60008/notices/1504153', '60008/notices/1504193', '60008/notices/1504166', '60008/notices/1504210', '60008/notices/1504134', '60008/notices/1504167', '60008/notices/1504118', '60008/notices/1504218', '60008/notices/1504144', '60008/notices/1504148', '60008/notices/1504208', '60008/notices/1504162', '60008/notices/1504126', '60008/notices/1504119', '60008/notices/1504140', '60008/notices/1504176', '60008/notices/1504192', '60008/notices/1504188', '60008/notices/1504133', '60008/notices/1504180', '60008/notices/1504213', '60008/notices/1504094', '60008/notices/1504219', '60008/notices/1504107', '60008/notices/1504183', '60008/notices/1504114', '60008/notices/1504122', '60008/notices/1504169', '60008/notices/1504130', '60008/notices/1504205', '60008/notices/1504139', '60008/notices/1504138', '60008/notices/1504106', '60008/notices/1504101', '60008/notices/1504098', '60008/notices/1504187', '60008/notices/1504172', '60008/notices/1504186', '60008/notices/1504146', '60008/notices/1504179', '60008/notices/1504165', '60008/notices/1504110', '60008/notices/1504132', '60008/notices/1504160', '60008/notices/1504191', '60008/notices/1504096', '60008/notices/1504170', '60008/notices/1504097', '60008/notices/1504092', '60008/notices/1504127', '60008/notices/1504102', '60008/notices/1504147', '60008/notices/1504128', '60008/notices/1504111', '60008/notices/1504196', '60008/notices/1504115', '60008/notices/1504200', '60008/notices/1504164', '60008/notices/1504194', '60008/notices/1504217', '60008/notices/1504131', '60008/notices/1504136', '60008/notices/1504100', '60008/notices/1504184', '60008/notices/1504198', '60008/notices/1504129', '60008/notices/1504206', '60008/notices/1504221', '60008/notices/1504220', '59982/notices/1488060', '59982/notices/1488113', '59982/notices/1488039', '59984/notices/1488950', '59985/notices/1489942', '59989/notices/1492216', '59995/notices/1494997', '59999/notices/1497321', '59999/notices/1497320', '60002/notices/1499138', '60002/notices/1499144', '60003/notices/1499964', '60003/notices/1499958', '60004/notices/1500663', '60005/notices/1502228', '60005/notices/1502209', '60007/notices/1503269', '60008/notices/1504216']

#go through the schoolIDs array above, and for each ID...
for item in codes:
    #show it in the console
    print item
    #create a URL called 'next_link' which adds that ID to the end of the base_url variable
    next_link = base_url+item
    #pass that new concatenated URL to a function, 'scrape_page', which is scripted above
    scrape_page(next_link)



