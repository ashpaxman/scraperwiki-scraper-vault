import scraperwiki


# Helping https://scraperwiki.com/scrapers/gordo
# Currently this scrapes div id="detailtext" in each page
# Needs to be refined so that you're grabbing <b> and <br/> tags within that - or regex?
# Also needs simplifying/renaming of variables/comments etc.

#If you want to understand this scraper - start at the bottom where it says 'base_url' (line 52 or so)

import scraperwiki
#import urlparse
import lxml.html

#Create a function called 'scrape_table' which is called in the function 'scrape_page' below
#The 'scrape_page' function also passed the contents of the page to this function as 'root'
def scrape_table(root):
    #Use cssselect to find the contents of a particular HTML tag, and put it in a new object 'rows'
    #there's more than one table, so we need to specify the class="destinations", represented by the full stop
    rows = root.cssselect("div#detailtext")
    for row in rows:
        #Create a new empty record
        record = {}
            #Put the contents of the first <td> into a record in the column 'FSM'
        record['FSM'] = row.text_content()
            #this takes the ID number, which has been named item in the for loop below
        record['ID'] = item
        print record, '------------'
            #Save in the SQLite database, with the ID code to be used as the unique reference
        scraperwiki.sqlite.save(["ID"], record)


#this creates a new function and (re)names whatever parameter is passed to it - i.e. 'next_link' below - as 'url'
def scrape_page(url):
    #now 'url' is scraped with the scraperwiki library imported above, and the contents put into a new object, 'html'
    html = scraperwiki.scrape(url)
    print html
    #now we use the lxml.html function imported above to convert 'html' into a new object, 'root'
    root = lxml.html.fromstring(html)
    #now we call another function on root, which we write - above
    scrape_table(root)

#START HERE: This is the part of the URL which all our pages share
base_url = 'http://marinetraffic.com/ais/shipdetails.aspx?MMSI='
#And these are the numbers which we need to complete that URL to make each individual URL
#This list has been compiled using the =JOIN formula in Google Docs on a column of mmsi numbers
schoolIDs = ['24616700',    '111111111',    '205535000',    '209437000',    '209632000',    '210473000',    '211194000',    '211531000',    '211771000',    '211873000',    '212939000',    '215190000',    '215193000',    '215517000',    '215919000',    '218735000',    '219196000',    '219219000',    '232184000',    '232248000',    '232687000',    '232971000',    '235003000',    '235004340',    '235009350',    '235009780',    '235011910',    '235021704',    '235023621',    '235023623',    '235037261',    '235051174',    '235054938',    '235057705',    '235059368',    '235059376',    '235060306',    '235060679',    '235068085',    '235068882',    '235070413',    '235075024',    '235075245',    '235077714',    '235604000',    '235620000',    '235764000',    '236273000',    '239282000',    '239557000',    '239579000',    '240174000',    '240916000',    '241031000',    '244461000',    '245266000',    '246325000',    '246767000',    '247176000',    '247218400',    '247240100',    '247283800',    '247288400',    '248179000',    '248223000',    '248412000',    '248708000',    '249029000',    '249174000',    '249235000',    '249442000',    '249778000',    '249889000',    '253125000',    '256598000',    '256808000',    '257349000',    '257366000',    '257654000',    '257714000',    '257869000',    '259025000',    '259805000',    '265024000',    '265884000',    '265899000',    '269108000',    '271040509',    '303345000',    '304010426',    '304010427',    '304010936',    '304172000',    '304173000',    '304639000',    '304803000',    '304998000',    '305051000',    '305134000',    '305222000',    '305271000',    '305315000',    '305460000',    '305593000',    '305791000',    '305796000',    '306839000',    '308275000',    '308369000',    '308431000',    '308524000',    '308688000',    '308789000',    '308798000',    '309601000',    '309764000',    '309955000',    '309996000',    '310559000',    '310627000',    '311002800',    '311010900',    '311011700',    '311018600',    '311019100',    '311019700',    '311036700',    '311037900',    '311042700',    '311056300',    '311165000',    '311319000',    '311728000',    '311918000',    '311919000',    '319024000',    '319027200',    '319028000',    '319570000',    '319730000',    '319866000',    '319950000',    '338038000',    '338613000',    '338779000',    '338989000',    '351017000',    '351031000',    '351113000',    '351219000',    '351413000',    '351429000',    '351481000',    '351515000',    '351518000',    '351613000',    '351617000',    '351656000',    '351682000',    '351690000',    '351742000',    '351757000',    '351763000',    '351801000',    '351819000',    '351821000',    '351862000',    '351865000',    '351893000',    '351899000',    '351925000',    '351990000',    '352012000',    '352045000',    '352147000',    '352161000',    '352256000',    '352360000',    '352421000',    '352471000',    '352494000',    '352503000',    '352603000',    '352604000',    '352647000',    '352759000',    '352784000',    '352789000',    '352809000',    '352819000',    '352848000',    '352866000',    '352890000',    '352905000',    '352911000',    '352936000',    '352984000',    '352992000',    '352993000',    '353039000',    '353131000',    '353173000',    '353180000',    '353334000',    '353343000',    '353394000',    '353472000',    '353553000',    '353585000',    '353712000',    '353923000',    '353936000',    '353937000',    '353947000',    '354056000',    '354151000',    '354235000',    '354280000',    '354289000',    '354332000',    '354342000',    '354343000',    '354346000',    '354348000',    '354357000',    '354375000',    '354421000',    '354426000',    '354445000',    '354477000',    '354527000',    '354562000',    '354661000',    '354715000',    '354731000',    '354793000',    '354807000',    '354826000',    '354895000',    '354920000',    '354921000',    '354953000',    '355038000',    '355095000',    '355142000',    '355163000',    '355174000',    '355227000',    '355230000',    '355310000',    '355311000',    '355315000',    '355326000',    '355352000',    '355420000',    '355424000',    '355428000',    '355465000',    '355514000',    '355522000',    '355551000',    '355640000',    '355649000',    '355745000',    '355765000',    '355798000',    '355813000',    '355815000',    '355820000',    '355835000',    '355891000',    '355929000',    '355950000',    '356017000',    '356071000',    '356072000',    '356139000',    '356150000',    '356152000',    '356160000',    '356222000',    '356423000',    '356427000',    '356448000',    '356462000',    '356476000',    '356543000',    '356580000',    '356589000',    '356693000',    '356714000',    '356721000',    '356744000',    '356758000',    '356773000',    '356844000',    '356847000',    '356882000',    '356883000',    '356885000',    '356927000',    '356968000',    '357094000',    '357134000',    '357244000',    '357313000',    '357427000',    '357435000',    '357437000',    '357457000',    '357481000',    '357507000',    '357557000',    '357586000',    '357667000',    '357674000',    '357676000',    '357812000',    '357899000',    '357902000',    '357917000',    '357920000',    '366338750',    '367067440',    '369326000',    '369810000',    '370018000',    '370107000',    '370128000',    '370130000',    '370149000',    '370150000',    '370205000',    '370214000',    '370229000',    '370295000',    '370326000',    '370338000',    '370370000',    '370418000',    '370422000',    '370460000',    '370579000',    '370644000',    '370727000',    '370735000',    '370760000',    '370761000',    '370830000',    '370887000',    '370927000',    '370965000',    '370971000',    '370981000',    '371003000',    '371061000',    '371065000',    '371118000',    '371204000',    '371208000',    '371232000',    '371234000',    '371237000',    '371240000',    '371281000',    '371290000',    '371313000',    '371359000',    '371522000',    '371605000',    '371627000',    '371712000',    '371749000',    '371757000',    '371766000',    '371785000',    '371797000',    '371816000',    '371820000',    '371824000',    '371826000',    '371827000',    '371980000',    '371982000',    '371993000',    '371998000',    '372030000',    '372042000',    '372083000',    '372091000',    '372095000',    '372097000',    '372140000',    '372181000',    '372252000',    '372264000',    '372306000',    '372346000',    '372379000',    '372388000',    '372395000',    '372403000',    '372459000',    '372543000',    '372604000',    '372612000',    '372613000',    '372666000',    '372682000',    '372759000',    '372779000',    '372879000',    '372897000',    '372919000',    '372941000',    '372949000',    '372957000',    '372995000',    '373017000',    '373052000',    '373096000',    '373256000',    '373445000',    '373531000',    '373657000',    '373725000',    '373784000',    '373822000',    '376177000',    '376227000',    '377191000',    '412000000',    '412043020',    '412067000',    '412202350',    '412221000',    '412226000',    '412249000',    '412320620',    '412420552',    '412420645',    '412513000',    '412694950',    '412696240',    '412985000',    '413145000',    '413280000',    '413461340',    '413770000',    '413834000',    '416076700',    '416196800',    '416233600',    '416359000',    '419000175',    '419652000',    '431008000',    '431106000',    '431116000',    '431137000',    '431159000',    '431206000',    '431251000',    '431380000',    '431511000',    '431587000',    '431595000',    '431679000',    '431722000',    '431760000',    '431769000',    '431790000',    '431801000',    '431812000',    '431828000',    '431932000',    '431935000',    '431938000',    '432187000',    '432355000',    '432487000',    '432507000',    '432549100',    '432613000',    '432626000',    '432633000',    '432644000',    '432661000',    '432691000',    '432713000',    '432726000',    '432733000',    '432744000',    '432750000',    '432772000',    '432774000',    '432777000',    '432786000',    '432788000',    '432838000',    '432841000',    '440108000',    '440236000',    '440444000',    '440481000',    '440604000',    '440620000',    '440640000',    '440645000',    '440647000',    '440715000',    '440770000',    '440782000',    '440823000',    '440975000',    '440992000',    '441029000',    '441054000',    '441142000',    '441216000',    '441597000',    '441619000',    '441660000',    '441720000',    '444095214',    '445116000',    '451004112',    '477003800',    '477011000',    '477013600',    '477014700',    '477046800',    '477053000',    '477058100',    '477059000',    '477060000',    '477061000',    '477062000',    '477069000',    '477071800',    '477094000',    '477101000',    '477105400',    '477110700',    '477110800',    '477113000',    '477125200',    '477143900',    '477167900',    '477185500',    '477192500',    '477206000',    '477214800',    '477235000',    '477264900',    '477280800',    '477328700',    '477351500',    '477435400',    '477473000',    '477541100',    '477600800',    '477614500',    '477622700',    '477627600',    '477646000',    '477651000',    '477661100',    '477661400',    '477688000',    '477690800',    '477701000',    '477709000',    '477728800',    '477738100',    '477746400',    '477746700',    '477746800',    '477748900',    '477751000',    '477768700',    '477795600',    '477807000',    '477808000',    '477851200',    '477860000',    '477868000',    '477869000',    '477876000',    '477883100',    '477898700',    '477903200',    '477924000',    '477962600',    '477969900',    '477985800',    '503492000',    '514565000',    '515717000',    '518132000',    '518403000',    '521439720',    '525025072',    '529004000',    '529089000',    '529125000',    '529139000',    '529244000',    '529277000',    '529366000',    '530149576',    '533000748',    '533000991',    '538002595',    '538002797',    '538002989',    '538002996',    '538003004',    '538003218',    '538003251',    '538003266',    '538003285',    '538003359',    '538003520',    '538003522',    '538003594',    '538003620',    '538003767',    '538003932',    '538003976',    '538004037',    '538004187',    '538004226',    '538004237',    '538004355',    '538004426',    '538004434',    '538004476',    '538004526',    '538060005',    '538060019',    '538070745',    '538090181',    '538090268',    '538090360',    '538090445',    '540000350',    '540001000',    '540003100',    '540003400',    '540006000',    '540007250',    '540007600',    '540008300',    '540009300',    '540009600',    '540010600',    '540010700',    '540010800',    '540010900',    '540123000',    '548206000',    '548264000',    '548521000',    '548692000',    '548698000',    '548704000',    '548705000',    '548748000',    '548781000',    '548801000',    '553111115',    '553111367',    '553111545',    '553111648',    '557003100',    '563026000',    '563171000',    '563212000',    '563233000',    '563270000',    '563380000',    '563545000',    '563876000',    '563909000',    '564044000',    '564057000',    '564065000',    '564203000',    '564217000',    '564258000',    '564268000',    '564361000',    '564365000',    '564443000',    '564583000',    '564614000',    '564643000',    '564684000',    '564845000',    '564853000',    '564896000',    '565123000',    '565152000',    '565188000',    '565253000',    '565255000',    '565302000',    '565392000',    '565657000',    '565750000',    '565845000',    '565967000',    '565977000',    '565997000',    '566005000',    '566082000',    '566084000',    '566184000',    '566197000',    '566337000',    '566899000',    '567226000',    '570440000',    '572392210',    '574418000',    '576004000',    '576006000',    '576071000',    '576081000',    '576363000',    '577000700',    '578000400',    '635216000',    '636008973',    '636009386',    '636009495',    '636010560',    '636010900',    '636011235',    '636011280',    '636011335',    '636012261',    '636012362',    '636012387',    '636012596',    '636013611',    '636014031',    '636014076',    '636014401',    '636014565',    '636014570',    '636014673',    '636014894',    '636014906',    '636015158',    '636015227',    '636015228',    '636015296',    '636015370',    '636015479',    '636090435',    '636090737',    '636090976',    '636091036',    '636091087',    '636091088',    '636091195',    '636091319',    '636091466',    '636091615',    '636091707',    '636091708',    '636091717',    '636091816',    '636091887',    '636091917',    '636091993',    '636092007',    '636092069',    '636092159',    '636092182',    '636092198',    '636092343',    '636092365',    '667003079',    '667003111',    '667003151',    '667003285',
]

#go through the schoolIDs list above, and for each ID...
for item in schoolIDs:
    #show it in the console
    print item
    #create a URL called 'next_link' which adds that ID to the end of the base_url variable
    next_link = base_url+item
    #pass that new concatenated URL to a function, 'scrape_page', which is scripted above
    scrape_page(next_link)
