<?php
require 'scraperwiki/simple_html_dom.php';
//  The following is a list of Exchange SAUIDs gleaned from Openreach
$codes = array("SMAI", "LWACT", "NIAGH", "NIAL", "NIAH", "LNADK", "THAD", "THATN", "MRALT", "STANDVR", "NIAE", "NIAT", "NIAR", "NIAM", "MYARM", "NIAY", "THAS", "NDASF", "MRASH", "NIAN", "NEAYC", "SMAY", "THBA", "NIBMS", "NIBL", "NIBT", "NIBC", "NIBGY", "NIBN", "NIBKR", "NIBM", "NIBO", "NIBNH", "NIBRN", "NIBYS", "NIBWR", "NIBB", "SMBB", "NIBA", "LNBKG", "LNBAR", "SWCFK", "THBZ", "THBZ", "SMBCD", "NDBEA", "SLBC", "LSBEC", "SMBF", "NIBCO", "NIBML", "NICTY", "NIBNA", "NIBEK", "NIBNB", "NIBRA", "SMBK", "CMBER", "NIBSB", "LSBEU", "LSBEX", "SMBI", "EABCY", "LCBIR", "EABIS", "STBISHW", "THBW", "SSBBN", "SSBBN", "MRBOL", "EABOR", "WSBOT", "STBOTLY", "THBEN", "LNBPK", "SMBA", "EABNT", "MRBRA", "NIBDY", "EABRW", "SWBNP", "SDHV", "SDWTHDN", "SSNOR", "SSWES", "LSBRO", "WMBPZ", "NIBKB", "NIBRH", "THBO", "SLBH", "NIBRS", "THBN", "CMBNW", "MRBUR", "EABSE", "LWBUS", "NIBH", "SWCAB", "MYCAL", "NICDN", "THC", "NICSI", "CLCAN", "SWCFATE", "NICL", "NIC", "NICE", "NICF", "NICD", "NICA", "MYCAS", "NICRH", "NICLK", "NICW", "LSCTFD", "THCV", "STCFORD", "MRCHE", "EACHE", "SWCJ", "CMCHY", "LSCHES", "WNCSS", "SLCD", "NECT", "LNCHF", "SSCHI", "LCCHO", "MRCHO", "NICDY", "CLCLE", "NICG", "NICM", "NICH", "NICI", "EMCOALV", "NICN", "LWCOL", "NICR", "MRCON", "WNDEE", "NICK", "NDCOP", "NECM", "SDCRWLY", "NICRG", "LWCRI", "NICRS", "NICGR", "NICMG", "LNCED", "THCW", "LSCRO", "NICMN", "NICB", "NICUS", "ESDAB", "LSDAR", "ESDEA", "MRDEN", "NIDRY", "NIDY", "NIDYN", "NIDK", "WWDRAN", "SMDC", "MRDID", "NIDD", "NIDM", "ESDON", "SSDOW", "EADOW", "NIDP", "NIDPT", "WMDRO", "NIDMA", "NIDO", "NIDMR", "SLDF", "NIDQ", "LSDUL", "NIDNM", "ESBRF", "ESPAR", "NIDLD", "NIDOD", "ESDUF", "NIDG", "NIDV", "NEDU", "LWEAL", "THEAR", "CMEARD", "NDEGR", "NEEHN", "STEASTL", "LWEDG", "ESCOR", "ESCRA", "LNEDM", "LWEGH", "NIEG", "LWELS", "LSELT", "LNENF", "NIEK", "EMETWLL", "WMEV", "MRFAI", "STFAIRO", "CMFAL", "THFB", "THFJ", "EMFAZEL", "NIFY", "LWFEL", "WMFER", "NIFIN", "NIFN", "THFT", "NIFCT", "NIFH", "NIFWM", "LNGHL", "MYGRF", "NIGVA", "THGX", "NIGF", "NIGFD", "WSBRI", "WSBUS", "WSGIF", "WSHAL", "WSNEW", "WSWES", "NIGN", "NIGGY", "MRGLO", "THGG", "LWGOL", "LNGDM", "NIGT", "NEGF", "NDGRA", "CMGREB", "LWGRE", "LSGRNW", "NIGY", "LSGRO", "THGI", "MYGUI", "LNHAI", "MYHAL", "WEWHAM", "LWHARL", "SMHR", "MYHGT", "LWHARR", "MRHAR", "THHM", "WMHAS", "WNHAW", "MYHEA", "SMHD", "CMHEA", "MRHEA", "CMHED", "NIHB", "SMHH", "SWHXM", "THHT", "LCHBK", "LVHES", "NEHT", "SMHY", "LNHPK", "NIHO", "CMHILL", "EMHINCK", "LNHOD", "SMHGN", "NIHW", "SDHRLY", "LNHOR", "SDHRSHM", "LWHOU", "MRHUL", "MRHYD", "LNILC", "LNILN", "LNING", "NIIT", "NIKY", "NIKS", "CMKEN", "CLKEN", "LWKROA", "NIKH", "LSKID", "NIKI", "NIKVY", "NIKL", "NIKYL", "NIKA", "LWKIN", "CLKLG", "LSKIN", "NIKN", "CMKNO", "THLL", "NILE", "LNLVY", "SMLEA", "CMLGS", "CMLEA", "LSLEE", "WWLEED", "EALGH", "SMLBD", "LCLEY", "CMLIC", "NILY", "NILI", "NILN", "NILA", "ESLVS", "SWLLD", "SWLNI", "SWLLO", "SWLLR", "STLOCKH", "MYLOF", "NILDM", "EMLONGE", "EMLGHBO", "NILL", "LNLOU", "MYLOW", "CLLOW", "NILG", "SMLT", "LVLYM", "MRMAC", "NIMA", "NIMF", "THM", "LSMAL", "NIMAL", "MREAS", "EMMRKTH", "NIMH", "NIMTN", "NIMZ", "NEMEA", "LSMEPK", "EMMICKL", "MRMDW", "SSMID", "LNMED", "LWMIL", "NIME", "SMBT", "LSMIT", "NIMR", "LSMOL", "NIMM", "MYMOR", "LSMOR", "SLMOS", "MRMOS", "NIMFD", "NIMOY", "LNMUS", "EMNARBO", "NENP", "CLNEW", "LNNWS", "THNU", "NINE", "SMNP", "NINY", "NINS", "SWNVW", "NINTS", "NINB", "NINH", "WRNELMS", "LWNEDG", "LWNWEM", "CMNOR", "MRNOR", "LWNWOO", "CMNUN", "EMODDBY", "MROLD", "MROLD", "NIOM", "NIORM", "EMORTON", "SMOF", "LNPGN", "WWPAR", "WRPGRN", "SWPBM", "SWPND", "LVPEN", "SMPEN", "LCPEW", "LWPIN", "EMPOLSW", "NIPY", "LNPON", "MYPON", "LNPOP", "NIPO", "NIPT", "NIPVE", "NIPE", "SSPOR", "WWPREA", "NIPR", "SDPCNTC", "NIPS", "MRPRE", "WEWPRI", "MYPUD", "LSPUT", "SSRAD", "LCRAM", "NIRT", "SLRN", "NIRN", "NIRD", "THRG", "THS", "NIRI", "MRRIN", "STRINGW", "LNROM", "NIRL", "NIRS", "MYROT", "CMRUGB", "LWRUI", "EMRUSHD", "LSRUS", "MRRUS", "MRSAD", "NISD", "MRSAL", "NISEA", "NESHM", "NDSEV", "SMSU", "EMSHRWO", "MYSHI", "LSSID", "NISM", "NDSIT", "LWSKY", "LSSLA", "CMSOL", "EASBF", "LSCLPM", "LWSHAR", "EASND", "NISP", "WWSAGN", "LNSTB", "WWSDAY", "EMSTIVE", "EMSTNEO", "LWSTAI", "MRSTA", "LNSTA", "EASTF", "EASTD", "WWSTEN", "MRSTE", "SMSX", "NISTN", "MRSTO", "LVSTK", "NISTF", "EMSTNYG", "SMSSF", "NISTM", "NISE", "LNSTF", "CMSTRA", "LSSTR", "SMSM", "LSSUR", "LSSUT", "EMSTTEL", "EMSWADL", "NISW", "SSSWN", "MRSWI", "SWTAT", "EMTMWOR", "NITG", "LSTED", "NITP", "NITO", "CMTET", "LSTHMD", "WWTHRE", "NDTON", "NITB", "SSTHL", "LNTOT", "LCTOT", "STTOTTN", "EMTRENT", "NITR", "SSTRO", "NITC", "NDTWE", "THTF", "CLUPP", "MRURM", "LWUXB", "WRVAUX", "MRWAL", "LSWAL", "CMWL", "LNWCR", "LSWLTN", "CLWAL", "LNWSD", "SMWN", "NIWT", "NIWP", "CMWARW", "NILDW", "LWWAT", "CMWED", "LWWDRA", "EMWESTO", "SWWXC", "NIWBY", "NIWD", "EAWFD", "WMWLN", "MRWIL", "LSWIM", "STWINCH", "LNWIN", "MRWIN", "THWM", "SMWV", "LNWFD", "THWDY", "LSWOO", "WMWR", "LSWOR", "WMSTJ", "WMSTP", "SSWOR", "THY", "EMYXLEY", "MYYO");
//This segment takes the SamKnows database URL, inputs the exchange SAUID and then searches for the postcode.
foreach($codes as $code) {
    echo "Loading " . $code . "...";
    $html = scraperWiki::scrape("http://www.samknows.com/broadband/exchange/" . $code);
    echo "Loaded";
    $dom = new simple_html_dom();
    $dom->load($html);
    foreach ($dom->find("div.item-content tr") as $row) {
      $headers = $row->find("th");
      $columns = $row->find("td");
      if (preg_match("/Postcode/", $headers[0]->plaintext)) {
        echo $code . ": " . $columns[0]->plaintext;
        scraperwiki::save(array("code"), array("code"=>$code, "postcode"=>$columns[0]->plaintext));
        break;
      }
   }
}
?>
