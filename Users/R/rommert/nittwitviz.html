<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    
    <title>DataViz NitTwit</title>
    
    <script src="http://d3js.org/d3.v2.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    
    <script type="text/javascript" charset="utf-8">
    $.extend( {
      getValues: function( sql ) {
        var result = null;
        $.ajax({
            url: 'https://api.scraperwiki.com/api/1.0/datastore/sqlite?'
              + 'format=jsondict&name=nittwit&query='
              + encodeURI( sql ),
            type: 'get',
            dataType: 'json',
            async: false,
            success: function(data) {
                result = data;
            }
        });
        return result;
        }
    } );
    
    $( function() {
            
            var shit = $.getValues( 'select COUNT( * ) as count from `swdata` where `text` like( "%shit%" )' );
            var piss = $.getValues( 'select COUNT( * ) as count from `swdata` where `text` like( "%piss%" )' );
            var fuck = $.getValues( 'select COUNT( * ) as count from `swdata` where `text` like( "%fuck%" )' );
            var cunt = $.getValues( 'select COUNT( * ) as count from `swdata` where `text` like( "%cunt%" )' );
            var cocksucker = $.getValues( 'select COUNT( * ) as count from `swdata` where `text` like( "%cocksucker%" )' );
            var motherfucker = $.getValues( 'select COUNT( * ) as count from `swdata` where `text` like( "%motherfucker%" )' );
            var tits = $.getValues( 'select COUNT( * ) as count from `swdata` where `text` like( "%tits%" )' );
            
            
              var data = [{year: 'shit', books: shit[0].count},
                          {year: 'piss', books: piss[0].count},
                          {year: 'fuck', books: fuck[0].count},
                          {year: 'cunt', books: cunt[0].count},
                          {year: 'cocksucker', books: cocksucker[0].count},
                          {year: 'motherfucker', books: motherfucker[0].count},
                          {year: 'tits', books: tits[0].count},
                          ];

              var barWidth = 40;
              var width = (barWidth + 10) * data.length;
              var height = 200;

              var x = d3.scale.linear().domain([0, data.length]).range([0, width]);
              var y = d3.scale.linear().domain([0, d3.max(data, function(datum) { return datum.books; })]).
                rangeRound([0, height]);

              // add the canvas to the DOM
              var barDemo = d3.select("#bar-demo").
                append("svg:svg").
                attr("width", width).
                attr("height", height);

              barDemo.selectAll("rect").
                data(data).
                enter().
                append("svg:rect").
                attr("x", function(datum, index) { return x(index); }).
                attr("y", function(datum) { return height - y(datum.books); }).
                attr("height", function(datum) { return y(datum.books); }).
                attr("width", barWidth).
                attr("fill", "#2d578b");

              var padding = 30;
              var barDemo = d3.select("#data-viz").
                append("svg:svg").
                attr("width", width).
                attr("height", height + padding);

              barDemo.selectAll("rect").
                data(data).
                enter().
                append("svg:rect").
                attr("x", function(datum, index) { return x(index); }).
                attr("y", function(datum) { return height - y(datum.books); }).
                attr("height", function(datum) { return y(datum.books); }).
                attr("width", barWidth).
                attr("fill", "#2d578b");

              barDemo.selectAll("text").
                data(data).
                enter().append("svg:text").
                attr("x", function(datum, index) { return x(index) + barWidth; }).
                attr("y", function(datum) { return height - y(datum.books); }).
                attr("dx", -barWidth/2).
                attr("dy", "1.2em").
                attr("text-anchor", "middle").
                attr("style", "font-size: 12; font-family: Helvetica, sans-serif;").
                text(function(datum) { return datum.books;}).
                attr("fill", "white");

              barDemo.selectAll("text.yAxis").
                data(data).
                enter().append("svg:text").
                attr("x", function(datum, index) { return x(index) + barWidth; }).
                attr("y", height).
                attr("dx", -barWidth/2).
                attr("text-anchor", "middle").
                attr("style", "font-size: 12; font-family: Helvetica, sans-serif").
                text(function(datum) { return datum.year;}).
                attr("transform", "translate(0, 18)").
                attr("class", "yAxis");
      
    } );
    </script>
    
  </head>
  
  <body>
    <div id="data-viz"></div>
  </body>
</html>