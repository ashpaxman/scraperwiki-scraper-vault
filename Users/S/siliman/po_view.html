<html>
<head>
  <script src="http://maps.google.com/maps/api/js?sensor=false&region=SI"></script>
  <script src="http://media.scraperwiki.com/js/jquery-1.3.2.js"></script>
</head>
<body>

<h2>General map thing for <span>...</span></h2>
<p>Fill in the names of your lat and lng columns in the sqlselect variable below</p>

<div id="mapdiv" style="width:100%;height:600px"></div>


<script>
var map;
var sourcescraper = 'siliman';
function makemap()
{
    var cpos = new google.maps.LatLng(62.7, -22); 
    var mapOptions = { "zoom": 5, "center": cpos, "mapTypeId": google.maps.MapTypeId.TERRAIN };
    map = new google.maps.Map(document.getElementById("mapdiv"), mapOptions);

    var apiurl = "http://api.scraperwiki.com/api/1.0/datastore/sqlite?format=jsondict&name=po&query=select%20company_name,%20address%20from%20swdata%20limit%20300"; 
    var sqlselect = "select latlng_lat, latlng_lng from swdata limit 500";
    var icon = 'http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=X|0f0|f0f';
    var geocoder = new google.maps.Geocoder();

    $.ajax({url:apiurl, dataType: "jsonp", success:function(tdata)
    { 
        var data = tdata; 
      
        $.each(data, function(i, item){

            geocoder.geocode( { 'address': item.company_address}, function(results, status) {
                 if (status == google.maps.GeocoderStatus.OK) {
                     map.setCenter(results[0].geometry.location);
                     var marker = new google.maps.Marker({
                         map: map, 
                         position: results[0].geometry.location,
                         title: item.company_name
                     });   
                 } else {
                     console.log(status);
                 }
             });

        })

        
    }});
}
$(window).ready(function() 
{
    $("h2 span").text(sourcescraper); 
    makemap(); 
});
</script>




</body>
</html>

