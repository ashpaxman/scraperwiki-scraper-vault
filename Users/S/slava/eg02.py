import scraperwiki
import lxml.html
import urllib
import urllib2
import requests
import simplejson
import demjson
import re
# Blank Python




def get_areas(city_id):
    html = scraperwiki.scrape("http://www.bdc.com.eg/English/Pages/Locator.aspx",
        {'ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlCity': city_id,
         'ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ScriptManager1': 'ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$UpdatePanel1|ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlCity',
        '__SPSCEditMenu':'true',
        'MSOWebPartPage_PostbackSource':'',
        'MSOTlPn_SelectedWpId':'',
        'MSOTlPn_View':'0',
        'MSOTlPn_ShowSettings':'False',
        'MSOGallery_SelectedLibrary':'',
        'MSOGallery_FilterString':'',
        'MSOTlPn_Button':'none',
        '__REQUESTDIGEST' : '0xA16CD40813AE142FF09C709883BBA3E5018F35151E493D0C41027AFEA3192459718E439A8C1530FB0307A14305CCB63380EEBA08E443762657C9E2D32491FCF3,10 Dec 2012 16:22:38 -0000',
        'MSOAuthoringConsole_FormContext':'',
        'MSOAC_EditDuringWorkflow':'',
        'MSOSPWebPartManager_DisplayModeName':'Browse',
        'MSOWebPartPage_Shared':'',
        'MSOLayout_LayoutChanges':'',
        'MSOLayout_InDesignMode':'',
        'MSOSPWebPartManager_OldDisplayModeName':'Browse',
        'MSOSPWebPartManager_StartWebPartEditingName':'false',
        'ctl00$SearchBox1$txtBoxSrch':'',
        'ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlArea':'',
        'ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlCountry':'3',
        '__EVENTTARGET':'ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlCity',
        '__EVENTARGUMENT':'',
        '__LASTFOCUS':'',
        '__VIEWSTATE': '/wEPDwUBMA9kFgJmD2QWBAIED2QWAgIBD2QWAgIBD2QWAgIBDxYCHhNQcmV2aW91c0NvbnRyb2xNb2RlCymIAU1pY3Jvc29mdC5TaGFyZVBvaW50LldlYkNvbnRyb2xzLlNQQ29udHJvbE1vZGUsIE1pY3Jvc29mdC5TaGFyZVBvaW50LCBWZXJzaW9uPTEyLjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTcxZTliY2UxMTFlOTQyOWMBZAIGD2QWFAICD2QWAgUmZ19lNzJhODdhN18xODU1XzRmNWJfOGQ1OF84ZTc4MDEyMGM4OTgPZBYCZg9kFgQCBA9kFgJmD2QWBAIBDxAPFgIeC18hRGF0YUJvdW5kZ2QQFR0FQ2Fpcm8KQWxleGFuZHJpYQhJc21haWxpYQhQb3J0U2FpZAxTb3V0aCBTaW5haSAIUWFseXViaWEDUU5BB1JlZCBTZWENTWFyc2EgTWF0cm91aARTdWV6CkFsIFNoYXJreWEMQWwgRGFrYWhsZXlhC05vcnRoIFNpbmFpDkthZnIgRWwgU2hlaWtoC0VsIE1vbm9meWEgCkVsIGdoYXJieWEJRWwgQmVoZXJhCUVsIEZhaW91bQpCYW55IFN3ZWlmCEVsIE1lbmlhBUFzdWl0BVNvaGFnBUFzd2FuEUFsIHdhZGkgQWwgR2FkZWVkBkhlbHdhbgdFbCBHaXphJSAgICAgICAgICAgICAgICAgICAgICAgICAgICA2IG9jdG9iZXIGRG9teWF0BUx1eG9yFR0BMQEyATMBNAE1ATYBNwE4AjE0AjE1AjE2AjE4AjE5AjIxAjIzAjI0AjI1AjI2AjI3AjI4AjI5AjMwAjMxAjMyAjQzAjQ0AjQ1AjQ2AjQ3FCsDHWdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnFgECG2QCAw8QDxYCHwFnZBAVAgZEb215YXQLTmV3IERvbXlhdCAVAgMxMDQDMTA1FCsDAmdnZGQCBg8QDxYCHwFnZBAVWwdBTEJBTklBB0FMR0VSSUEJQVJHRU5USU5BCUFVU1RSQUxJQQdBdXN0cmlhB0JBSFJBSU4KQkFOR0xBREVTSAdCRUxBUlVTB0JFTEdJVU0GQlJBWklMCEJVTEdBUklBCENBTUVST1VOBkNBTkFEQQVDSElMRQVDSElOQRBDT1RFIETigJkgSVZPSVJFCENST0FUSUEgBENVQkEGQ1lQUlVTCkNaRUNIIFJFUC4IREVOTUFSSyAIRVJJVFJFQSAIRVRISU9QSUEIRklOTEFORCAHRlJBTkNFIAhHRVJNQU5ZIAVHSEFOQQZHUkVFQ0UJSE9ORyBLT05HCEhVTkdBUlkgBklORElBIAlJTkRPTkVTSUEESVJBTgRJUkFRCElSRUxBTkQgBklUQUxZIAZKQVBBTiAGSk9SREFOBktFTllBIAZLT1JFQSAGS1VXQUlUCExFQkFOT04gBUxJQllBCkxVWEVNQk9VUkcJTUFDRURPTklBCE1BTEFZU0lBBE1BTEkFTUFMVEEGTUVYSUNPBk1PTkFDTwdNT1JPQ0NPCk1PWkFNQklRVUULTkVXIFpFQUxBTkQHTklHRVJJQQdOT1JXQVkgBE9tYW4JUEFLSVNUQU4gC1BISUxJUFBJTkUgBlBPTEFORAlQT1JUVUdBTCAFUUFUQVIHUk9NQU5JQQhSVVNTSUEgIAxTQVVESSBBUkFCSUEHU0VORUdBTBVTRVJCSUEgQU5EIE1PTlRFTkVHUk8JU0lOR0FQT1JFCFNMT1ZBS0lBCFNMT1ZFTklBDVNPVVRIIEFGUklDQSAFU1BBSU4JU1JJIExBTktBBlNVREFOIBFTVUxUQU5BVEUgT0YgT01BTgdTV0VERU4gC1NXSVRaRVJMQU5EBVNZUklBBlRBSVdBTghUQU5aQU5JQQhUSEFJTEFORA9USEUgTkVUSEVSTEFORFMHVFVOSVNJQQdUVVJLRVkgBVUuQS5FA1UuSwZVR0FOREEHVUtSQUlORQNVU0EKVVpCRUtJU1RBTgVZRU1FTghaSU1CQUJXRRVbATMBNAE1ATYCMjABNwIxMQE4ATkCMTACMTICMTQCMTkCMTcCMTYCMjICMTMCMTgCMTUCMjECMjMCMjQCMjUCMjcCMjYCMjgCMzACMjkCMzECMzICMzcCMzQCMzgCMzUCMzMCMzYCNDACMzkCNDMCNDICNDECNDUCNDQCNDYCNTACNTMCNTICNTECNTQCNDkCNDcCNDgCNTUCNTcCNTYCOTQCNjECNjACNTkCNjICNjMCNjQCNjUCNzECNzUCOTACNjYCNzYCNjcCNjgCNzcCNzQCNzgCNjkCNzICNzMCNzACNzkCODICODECNTgCODACODMCODUCODYCODcCODQBMgI4OAI4OQI5MRQrA1tnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZGQCBA9kFgYCAQ9kFgICAg8PFgQeBFRleHQFB1NpZ24gSW4eB1Zpc2libGVnFgIeBXN0eWxlBQ5kaXNwbGF5OmJsb2NrO2QCAw9kFgICAQ8WAh8DaBYCZg9kFgQCAg9kFgICAw8WAh8DaGQCAw8PFgIeCUFjY2Vzc0tleQUBL2RkAgUPZBYCAgEPDxYCHwNoZBYEAgEPDxYCHwNoZGQCAw8PFgIfA2hkFgICAQ8PFgIfA2dkFgQCAQ8PFgIfA2hkFhwCAQ8PFgIfA2hkZAIDDxYCHwNoZAIFDw8WAh8DaGRkAgcPFgIfA2hkAgkPDxYCHwNoZGQCCw8PFgIfA2hkZAINDw8WAh8DaGRkAg8PDxYEHgdFbmFibGVkaB8DaGRkAhEPDxYCHwNoZGQCEw8PFgQfBmgfA2hkZAIVDw8WAh8DaGRkAhcPFgIfA2hkAhkPFgIfA2hkAhsPDxYCHwNnZGQCAw8PFgIfA2dkFgYCAQ8PFgIfA2dkZAIDDw8WAh8DZ2RkAgUPDxYCHwNnZGQCCA9kFgJmDw8WAh4ISW1hZ2VVcmwFF34vSW1hZ2VzL2xhbmdCdG5fYXIucG5nZGQCDg8PFhAeC0Rlc2NyaXB0aW9uZR4JRGlyZWN0aW9uCyoqU3lzdGVtLldlYi5VSS5XZWJDb250cm9scy5Db250ZW50RGlyZWN0aW9uAB4FVGl0bGUFBVBhZ2VzHgpDaHJvbWVUeXBlAgIeBF8hU0ICgIMIHgVXaWR0aBweBkhlaWdodBweC1BhcmFtVmFsdWVzMqEEAAEAAAD/////AQAAAAAAAAAMAgAAAFhNaWNyb3NvZnQuU2hhcmVQb2ludCwgVmVyc2lvbj0xMi4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj03MWU5YmNlMTExZTk0MjljBQEAAAA9TWljcm9zb2Z0LlNoYXJlUG9pbnQuV2ViUGFydFBhZ2VzLlBhcmFtZXRlck5hbWVWYWx1ZUhhc2h0YWJsZQEAAAAFX2NvbGwDHFN5c3RlbS5Db2xsZWN0aW9ucy5IYXNodGFibGUCAAAACQMAAAAEAwAAABxTeXN0ZW0uQ29sbGVjdGlvbnMuSGFzaHRhYmxlBwAAAApMb2FkRmFjdG9yB1ZlcnNpb24IQ29tcGFyZXIQSGFzaENvZGVQcm92aWRlcghIYXNoU2l6ZQRLZXlzBlZhbHVlcwAAAwMABQULCBxTeXN0ZW0uQ29sbGVjdGlvbnMuSUNvbXBhcmVyJFN5c3RlbS5Db2xsZWN0aW9ucy5JSGFzaENvZGVQcm92aWRlcgjsUTg/DgAAAAoKCwAAAAkEAAAACQUAAAAQBAAAAAMAAAAGBgAAAAZVc2VySUQGBwAAAAVUb2RheQYIAAAACExpc3ROYW1lEAUAAAADAAAABgkAAAAPQ3VycmVudFVzZXJOYW1lBgoAAAAUMjAxMi0xMi0xMFQxODozNzo0MVoGCwAAAAVQYWdlcwtkZAIQDw8WEB8IZR8JCysFAB8KBQlTaG9ydGN1dHMfCwICHwwCgIMIHw0cHw4cHw8ywAQAAQAAAP////8BAAAAAAAAAAwCAAAAWE1pY3Jvc29mdC5TaGFyZVBvaW50LCBWZXJzaW9uPTEyLjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTcxZTliY2UxMTFlOTQyOWMFAQAAAD1NaWNyb3NvZnQuU2hhcmVQb2ludC5XZWJQYXJ0UGFnZXMuUGFyYW1ldGVyTmFtZVZhbHVlSGFzaHRhYmxlAQAAAAVfY29sbAMcU3lzdGVtLkNvbGxlY3Rpb25zLkhhc2h0YWJsZQIAAAAJAwAAAAQDAAAAHFN5c3RlbS5Db2xsZWN0aW9ucy5IYXNodGFibGUHAAAACkxvYWRGYWN0b3IHVmVyc2lvbghDb21wYXJlchBIYXNoQ29kZVByb3ZpZGVyCEhhc2hTaXplBEtleXMGVmFsdWVzAAADAwAFBQsIHFN5c3RlbS5Db2xsZWN0aW9ucy5JQ29tcGFyZXIkU3lzdGVtLkNvbGxlY3Rpb25zLklIYXNoQ29kZVByb3ZpZGVyCOxROD8VAAAACgoLAAAACQQAAAAJBQAAABAEAAAABAAAAAYGAAAABlVzZXJJRAYHAAAABldlYlVSTAYIAAAABVRvZGF5BgkAAAAITGlzdE5hbWUQBQAAAAQAAAAGCgAAAA9DdXJyZW50VXNlck5hbWUGCwAAAAkvRW5nbGlzaC8GDAAAABQyMDEyLTEyLTEwVDE4OjM3OjQxWgYNAAAACVNob3J0Y3V0cwtkZAISDw9kFgQeBFBvbGwFBHRydWUeBlN1cnZleQUFZmFsc2VkAhQPZBYCZg8UKwACZA8WAh4GUG9sbElkBSQ0YmY2NGRiMy01YTljLTQ0NmYtOGQyZC0xMjRkMzQzNDUwMzVkFgRmDzwrAAUBBA8WAh4QRW5hYmxlVmFsaWRhdGlvbmdkFgQCAQ9kFgRmD2QWAmYPEGQQFQMJVmVyeSBHb29kBEdvb2QDQmFkFQMBMAExATIUKwMDZ2dnZGQCAQ9kFgICAg8PZBYCHgdvbmNsaWNrBZgCaWYoIVBhZ2VfQ2xpZW50VmFsaWRhdGUoImN0bDAwJFBvbGxWb3RlQW5kSGlzdG9yeVdlYlBhcnQxJGN0bDAxIikpIHJldHVybiBmYWxzZTtMaW5rRGV2LlBvbGxzLlJlc2V0Q2FsbGJhY2soKTtXZWJGb3JtX0RvQ2FsbGJhY2soJ2N0bDAwJFBvbGxWb3RlQW5kSGlzdG9yeVdlYlBhcnQxJGN0bDAwJywiOjI6MToxOjAiLExpbmtEZXYuUG9sbHMuT25DYWxsYmFja0NvbXBsZXRlLCJjdGwwMF9Qb2xsVm90ZUFuZEhpc3RvcnlXZWJQYXJ0MV9jdGwwMCIsbnVsbCxmYWxzZSk7cmV0dXJuIGZhbHNlO2QCAg9kFgQCAQ8PZBYCHxQFxgFMaW5rRGV2LlBvbGxzLlJlc2V0Q2FsbGJhY2soKTtXZWJGb3JtX0RvQ2FsbGJhY2soJ2N0bDAwJFBvbGxWb3RlQW5kSGlzdG9yeVdlYlBhcnQxJGN0bDAwJywiOjE6MjowIixMaW5rRGV2LlBvbGxzLk9uQ2FsbGJhY2tDb21wbGV0ZSwiY3RsMDBfUG9sbFZvdGVBbmRIaXN0b3J5V2ViUGFydDFfY3RsMDAiLG51bGwsZmFsc2UpO3JldHVybiBmYWxzZTtkAgMPD2QWAh8UBe4BaWYoIVBhZ2VfQ2xpZW50VmFsaWRhdGUoKSkgcmV0dXJuIGZhbHNlO0xpbmtEZXYuUG9sbHMuUmVzZXRDYWxsYmFjaygpO1dlYkZvcm1fRG9DYWxsYmFjaygnY3RsMDAkUG9sbFZvdGVBbmRIaXN0b3J5V2ViUGFydDEkY3RsMDAnLCI6MzoyOjAiLExpbmtEZXYuUG9sbHMuT25DYWxsYmFja0NvbXBsZXRlLCJjdGwwMF9Qb2xsVm90ZUFuZEhpc3RvcnlXZWJQYXJ0MV9jdGwwMCIsbnVsbCxmYWxzZSk7cmV0dXJuIGZhbHNlO2QCAg8PZBYCHxQFwgFMaW5rRGV2LlBvbGxzLlJlc2V0Q2FsbGJhY2soKTtXZWJGb3JtX0RvQ2FsbGJhY2soJ2N0bDAwJFBvbGxWb3RlQW5kSGlzdG9yeVdlYlBhcnQxJGN0bDAwJywiOjIiLExpbmtEZXYuUG9sbHMuT25DYWxsYmFja0NvbXBsZXRlLCJjdGwwMF9Qb2xsVm90ZUFuZEhpc3RvcnlXZWJQYXJ0MV9jdGwwMCIsbnVsbCxmYWxzZSk7cmV0dXJuIGZhbHNlO2QCFg8PFhAfCGUfCQsrBQAfCgULU3VydmV5IExpc3QfCwICHwwCgIMIHw0cHw4cHw8yvgQAAQAAAP////8BAAAAAAAAAAwCAAAAWE1pY3Jvc29mdC5TaGFyZVBvaW50LCBWZXJzaW9uPTEyLjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTcxZTliY2UxMTFlOTQyOWMFAQAAAD1NaWNyb3NvZnQuU2hhcmVQb2ludC5XZWJQYXJ0UGFnZXMuUGFyYW1ldGVyTmFtZVZhbHVlSGFzaHRhYmxlAQAAAAVfY29sbAMcU3lzdGVtLkNvbGxlY3Rpb25zLkhhc2h0YWJsZQIAAAAJAwAAAAQDAAAAHFN5c3RlbS5Db2xsZWN0aW9ucy5IYXNodGFibGUHAAAACkxvYWRGYWN0b3IHVmVyc2lvbghDb21wYXJlchBIYXNoQ29kZVByb3ZpZGVyCEhhc2hTaXplBEtleXMGVmFsdWVzAAADAwAFBQsIHFN5c3RlbS5Db2xsZWN0aW9ucy5JQ29tcGFyZXIkU3lzdGVtLkNvbGxlY3Rpb25zLklIYXNoQ29kZVByb3ZpZGVyCOxROD8OAAAACgoLAAAACQQAAAAJBQAAABAEAAAAAwAAAAYGAAAABlVzZXJJRAYHAAAABkxpc3RJRAYIAAAABVRvZGF5EAUAAAADAAAABgkAAAAPQ3VycmVudFVzZXJOYW1lBgoAAAAkNUZFRDY5OEItQkVEOS00MEM0LTlEQTItNTU5MkVFMzYxRkI1BgsAAAAUMjAxMi0xMi0xMFQxODozNzo0MVoLZGQCGA9kFhICAQ8WAh8ACysEAWQCAw9kFgJmDw8WAh8DaGRkAgUPZBYCZg8PFgIfA2hkZAIHD2QWAmYPDxYCHwNoZGQCCQ9kFgJmDw8WAh8DaGRkAgsPZBYCZg8PFgIfA2hkZAIND2QWAmYPDxYCHwNoZGQCDw9kFgJmDw8WAh8DaGRkAhEPZBYCZg8PFgIfA2hkZAIaD2QWAmYPFgIfAgWCGjx0YWJsZSB3aWR0aD0nMTAwJScgY2VsbHBhZGluZz0nMCcgY2VsbHNwYWNpbmc9JzAnPjx0cj48dGQgdmFsaWduPSd0b3AnPjxkaXYgY2xhc3M9J3NwYW4tMic+PHNwYW4gY2xhc3M9J3NlbGVjdGVkIHNwYW5Ib21lJyBzdHlsZT0nZGlzcGxheTpub25lJz5Ib21lPC9zcGFuPiA8YSBocmVmPSAiIC9FbmdsaXNoLyIgY2xhc3M9J2xua0hvbWUnPkhvbWU8L2E+PC9kaXY+PC90ZD48dGQgdmFsaWduPSd0b3AnPjxkaXYgY2xhc3M9J3NwYW4tNCBwcmVwZW5kLTEgbGFzdCc+PGEgaHJlZj0iL0VuZ2xpc2gvUGFnZXMvQ29udGFjdEJEQy5hc3B4Ij5XaGVyZSB0byBmaW5kIHVzIDwvYT48dWw+PGxpPjxhIGhyZWY9Ii9FbmdsaXNoL1BhZ2VzL1dvcmtpbmdIb3Vycy5hc3B4Ij5Xb3JraW5nIEhvdXJzIDwvYT48L2xpPjxsaT48YSBocmVmPSIvRW5nbGlzaC9QYWdlcy9Mb2NhdG9yLmFzcHgiPkJEQyBMb2NhdG9yPC9hPjwvbGk+PC91bD48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9QYWdlcy9SZXRhaWxfb2xkLmFzcHgiPlJldGFpbCBCYW5raW5nPC9hPjx1bD48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvTGluZW9mQnVzaW5lc3MvUmV0YWlsL1BhZ2VzL0FjY291bnRzLmFzcHgiPkFjY291bnRzPC9hPjwvbGk+PGxpPjxhIGhyZWY9Ii9FbmdsaXNoL0xpbmVvZkJ1c2luZXNzL1JldGFpbC9QYWdlcy9EZXBvc2l0LmFzcHgiPlRlcm0gRGVwb3NpdHM8L2E+PC9saT48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvTGluZW9mQnVzaW5lc3MvUmV0YWlsL1BhZ2VzL0NlcnRpZmljYXRlc09mRGVwb3NpdC5hc3B4Ij5DZXJ0aWZpY2F0ZXMgT2YgRGVwb3NpdDwvYT48L2xpPjxsaT48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9SZXRhaWwvUGFnZXMvUmV0YWlsTG9hbnMuYXNweCI+UmV0YWlsIExvYW5zPC9hPjwvbGk+PGxpPjxhIGhyZWY9Ii9FbmdsaXNoL0xpbmVvZkJ1c2luZXNzL1JldGFpbC9QYWdlcy9DYXJkcy5hc3B4Ij5DYXJkczwvYT48L2xpPjxsaT48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9SZXRhaWwvUGFnZXMvaW5zdXJhbmNlLmFzcHgiPkJhbmNhc3N1cmFuY2U8L2E+PC9saT48L3VsPjwvZGl2PjxkaXYgY2xhc3M9J3NwYW4tNCBwcmVwZW5kLTEgbGFzdCc+PGEgaHJlZj0iL0VuZ2xpc2gvTGluZW9mQnVzaW5lc3MvUGFnZXMvSW52ZXN0bWVudF9vbGQuYXNweCI+SW52ZXN0bWVudDE8L2E+PHVsPjxsaT48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9JbnZlc3RtZW50L1BhZ2VzL0N1bXVsYXRpdmVGdW5kLmFzcHgiPkN1bXVsYXRpdmUgRnVuZDwvYT48L2xpPjxsaT48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9JbnZlc3RtZW50L1BhZ2VzL0NhaXJvVG9kYXkuYXNweCI+Q2Fpcm8gVG9kYXk8L2E+PC9saT48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvTGluZW9mQnVzaW5lc3MvSW52ZXN0bWVudC9QYWdlcy9BbFdlZmFxLmFzcHgiPkFsIFdlZmFxIElzbGFtaWMgRnVuZDwvYT48L2xpPjwvdWw+PGEgaHJlZj0iL0VuZ2xpc2gvTWFya2V0VXBkYXRlcy9QYWdlcy9NYXJrZXRTdGF0aXN0aWNzLmFzcHgiPk1hcmtldFVwZGF0ZXM8L2E+PHVsPjxsaT48YSBocmVmPSIvRW5nbGlzaC9NYXJrZXRVcGRhdGVzL1BhZ2VzL0N1cnJlbmN5RXhjaGFuZ2UuYXNweCI+Q3VycmVuY3kgRXhjaGFuZ2UgUmF0ZXM8L2E+PC9saT48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvTWFya2V0VXBkYXRlcy9QYWdlcy9NYXJrZXRTdGF0aXN0aWNzLmFzcHgiPlN0b2NrIE1hcmtldCBpbmRpY2VzIHBlcmZvcm1hbmNlIDwvYT48L2xpPjwvdWw+PGEgaHJlZj0iL0VuZ2xpc2gvTmV3cy9QYWdlcy9OZXdzbGV0dGVyTGlzdGluZy5hc3B4Ij5OZXdzbGV0dGVyPC9hPjx1bD48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvUGFnZXMvU3Vic2NyaWJlLmFzcHgiPlN1YnNjcmliZTwvYT48L2xpPjxsaT48YSBocmVmPSIvRW5nbGlzaC9QYWdlcy9VbnN1YnNjcmliZS5hc3B4Ij5VbnN1YnNjcmliZTwvYT48L2xpPjwvdWw+PC9kaXY+PGRpdiBjbGFzcz0nc3Bhbi00IHByZXBlbmQtMSBsYXN0Jz48YSBocmVmPSIvRW5nbGlzaC9OZXdzL1BhZ2VzL05ld3NtYWluLmFzcHgiPkJEQyBOZXdzPC9hPjx1bD48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvTmV3cy9QYWdlcy9OZXdzTGlzdGluZy5hc3B4Ij5CREMgTmV3czwvYT48L2xpPjxsaT48YSBocmVmPSIvRW5nbGlzaC9Qcm9tb3Rpb25zL1BhZ2VzL1Byb21vdGlvbnNMaXN0aW5nLmFzcHgiPlNwZWNpYWwgUHJvbW90aW9uczwvYT48L2xpPjwvdWw+PGEgaHJlZj0iL0VuZ2xpc2gvUmVwb3J0cy9QYWdlcy9Bbm51YWxSZXBvcnRzLmFzcHgiPlJlcG9ydHM8L2E+PHVsPjxsaT48YSBocmVmPSIvRW5nbGlzaC9SZXBvcnRzL1BhZ2VzL0FubnVhbFJlcG9ydHMuYXNweCI+QW5udWFsIFJlcG9ydHM8L2E+PC9saT48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvUmVwb3J0cy9QYWdlcy9GaW5hbmNpYWxSZXBvcnRzLmFzcHgiPkZpbmFuY2lhbCBSZXBvcnRzPC9hPjwvbGk+PC91bD48L2Rpdj48L3RkPjx0ZCB2YWxpZ249J3RvcCc+PGRpdiBjbGFzcz0nc3Bhbi00IHByZXBlbmQtMSBsYXN0Jz48YSBocmVmPSIvRW5nbGlzaC9QYWdlcy9DdXN0b21lclNlcnZpY2VzLmFzcHgiPkN1c3RvbWVyIFNlcnZpY2UgPC9hPjxicj48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9QYWdlcy9Db3Jwb3JhdGUuYXNweCI+Q29ycG9yYXRlIEJhbmtpbmc8L2E+PGJyPjxhIGhyZWY9Ii9FbmdsaXNoL0xpbmVvZkJ1c2luZXNzL1BhZ2VzL1NNRV9vbGQuYXNweCI+RW50ZXJwcmlzZSBCYW5raW5nPC9hPjxicj48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9QYWdlcy9UcmVhc3VyeV9vbGQuYXNweCI+VHJlYXN1cnk8L2E+PGJyPjxhIGhyZWY9Ii9FbmdsaXNoL1BhZ2VzL0FwcGxpY2F0aW9ucy5hc3B4Ij5Gb3JtcyBhbmQgQXBwbGljYXRpb25zPC9hPjxicj48YSBocmVmPSIvRW5nbGlzaC9QYWdlcy9Db250YWN0VXMuYXNweCI+Q29udGFjdCBVczwvYT48YnI+PGEgaHJlZj0iL0VuZ2xpc2gvUGFnZXMvRmVlZGJhY2suYXNweCI+RmVlZGJhY2sgPC9hPjxicj48YSBocmVmPSIvRW5nbGlzaC9QYWdlcy9Vc2VmdWxMaW5rcy5hc3B4Ij5Vc2VmdWwgTGlua3M8L2E+PGJyPjxhIGhyZWY9Ii9FbmdsaXNoL1BhZ2VzL0NyZWF0ZUFjY291bnQuYXNweCI+QWNjb3VudCBPcGVuaW5nPC9hPjxicj48YSBocmVmPSIvRW5nbGlzaC9QYWdlcy9DYWxjdWxhdG9ycy5hc3B4Ij5DYWxjdWxhdG9yczwvYT48YnI+PGEgaHJlZj0iL0VuZ2xpc2gvUGFnZXMvUmVhZCBtb3JlLmFzcHgiPkltcG9ydGFudCBBbm5vdW5jZW1lbnQ8L2E+PGJyPjwvZGl2PjwvdGQ+PC90cj48L3RhYmxlPmQYAQUeX19Db250cm9sc1JlcXVpcmVQb3N0QmFja0tleV9fFgEFG2N0bDAwJExhbmd1YWdlJEltYWdlQnV0dG9uMQNqfMQkDpy/SZj1yMyPb0Y7X2eQ',
        '__ASYNCPOST':'true'})
    
    root = lxml.html.fromstring(html)
    areas = root.xpath("//select[@name='ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlArea']/option")
    print areas
    if areas != []:
        result = []
        for i in areas:
            result.append({'id': i.attrib['value'], 'name': i.text_content()})
        return result
    else:
        return []

def get_branches(area_id):
    
    payload = '{"loctype":"1,2", "area": ' + area_id +'}'
    headers = {'Content-Type': 'application/json', 
'X-AjaxPro-Method': 'AJAXSearchByArea',
'Referer': 'http://www.bdc.com.eg/English/Pages/Locator.aspx',
'Accept-Encoding': 'gzip,deflate,sdch'}

    r = requests.post('http://www.bdc.com.eg/ajaxpro/BDC.UserControls.Locator,BDC.ashx', data=payload, headers=headers)

    text= re.findall(r'Ajax\.Web\.DataTable\(.*?\]\]\,\[\[(.+?)\]\]\)', r.text, re.I|re.U)
    #print text
    try:
        _json = demjson.decode('[[' + text[0] + ']]')
        result = []
        for j in _json:
            result.append({'name': j[0], 'name_original':j[1], 'address': j[7], 'address_original': j[8], 'lat':j[10] , 'lng':j[11], 'other': j[14]})
            
        return result
    except:
        return []



#scraperwiki.sqlite.execute('delete from data')
html = scraperwiki.scrape("http://www.bdc.com.eg/English/Pages/Locator.aspx")
root = lxml.html.document_fromstring(html);

cities = root.xpath("//select[@name='ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlCity']/option")
i=1
for c in cities:
    #print c.attrib['value'], c.text_content()

    areas = get_areas(c.attrib['value'])
    #print areas
    for a in areas:
        branches = get_branches(a['id'])
        #print branches
        for b in branches:
            scraperwiki.sqlite.save(unique_keys=['id'], data={'id':i, 'city': c.text_content(), 'area': a['name'], 
                'branch_name': b['name'], 
                'branch_name_original': b['name_original'],
                'address': b['address'],
                'address_original': b['address_original'],
                'lat': b['lat'],
                'lng': b['lng'],
                'other': b['other']}, table_name='data_copy')
            i+=1

    

import scraperwiki
import lxml.html
import urllib
import urllib2
import requests
import simplejson
import demjson
import re
# Blank Python




def get_areas(city_id):
    html = scraperwiki.scrape("http://www.bdc.com.eg/English/Pages/Locator.aspx",
        {'ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlCity': city_id,
         'ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ScriptManager1': 'ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$UpdatePanel1|ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlCity',
        '__SPSCEditMenu':'true',
        'MSOWebPartPage_PostbackSource':'',
        'MSOTlPn_SelectedWpId':'',
        'MSOTlPn_View':'0',
        'MSOTlPn_ShowSettings':'False',
        'MSOGallery_SelectedLibrary':'',
        'MSOGallery_FilterString':'',
        'MSOTlPn_Button':'none',
        '__REQUESTDIGEST' : '0xA16CD40813AE142FF09C709883BBA3E5018F35151E493D0C41027AFEA3192459718E439A8C1530FB0307A14305CCB63380EEBA08E443762657C9E2D32491FCF3,10 Dec 2012 16:22:38 -0000',
        'MSOAuthoringConsole_FormContext':'',
        'MSOAC_EditDuringWorkflow':'',
        'MSOSPWebPartManager_DisplayModeName':'Browse',
        'MSOWebPartPage_Shared':'',
        'MSOLayout_LayoutChanges':'',
        'MSOLayout_InDesignMode':'',
        'MSOSPWebPartManager_OldDisplayModeName':'Browse',
        'MSOSPWebPartManager_StartWebPartEditingName':'false',
        'ctl00$SearchBox1$txtBoxSrch':'',
        'ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlArea':'',
        'ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlCountry':'3',
        '__EVENTTARGET':'ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlCity',
        '__EVENTARGUMENT':'',
        '__LASTFOCUS':'',
        '__VIEWSTATE': '/wEPDwUBMA9kFgJmD2QWBAIED2QWAgIBD2QWAgIBD2QWAgIBDxYCHhNQcmV2aW91c0NvbnRyb2xNb2RlCymIAU1pY3Jvc29mdC5TaGFyZVBvaW50LldlYkNvbnRyb2xzLlNQQ29udHJvbE1vZGUsIE1pY3Jvc29mdC5TaGFyZVBvaW50LCBWZXJzaW9uPTEyLjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTcxZTliY2UxMTFlOTQyOWMBZAIGD2QWFAICD2QWAgUmZ19lNzJhODdhN18xODU1XzRmNWJfOGQ1OF84ZTc4MDEyMGM4OTgPZBYCZg9kFgQCBA9kFgJmD2QWBAIBDxAPFgIeC18hRGF0YUJvdW5kZ2QQFR0FQ2Fpcm8KQWxleGFuZHJpYQhJc21haWxpYQhQb3J0U2FpZAxTb3V0aCBTaW5haSAIUWFseXViaWEDUU5BB1JlZCBTZWENTWFyc2EgTWF0cm91aARTdWV6CkFsIFNoYXJreWEMQWwgRGFrYWhsZXlhC05vcnRoIFNpbmFpDkthZnIgRWwgU2hlaWtoC0VsIE1vbm9meWEgCkVsIGdoYXJieWEJRWwgQmVoZXJhCUVsIEZhaW91bQpCYW55IFN3ZWlmCEVsIE1lbmlhBUFzdWl0BVNvaGFnBUFzd2FuEUFsIHdhZGkgQWwgR2FkZWVkBkhlbHdhbgdFbCBHaXphJSAgICAgICAgICAgICAgICAgICAgICAgICAgICA2IG9jdG9iZXIGRG9teWF0BUx1eG9yFR0BMQEyATMBNAE1ATYBNwE4AjE0AjE1AjE2AjE4AjE5AjIxAjIzAjI0AjI1AjI2AjI3AjI4AjI5AjMwAjMxAjMyAjQzAjQ0AjQ1AjQ2AjQ3FCsDHWdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnFgECG2QCAw8QDxYCHwFnZBAVAgZEb215YXQLTmV3IERvbXlhdCAVAgMxMDQDMTA1FCsDAmdnZGQCBg8QDxYCHwFnZBAVWwdBTEJBTklBB0FMR0VSSUEJQVJHRU5USU5BCUFVU1RSQUxJQQdBdXN0cmlhB0JBSFJBSU4KQkFOR0xBREVTSAdCRUxBUlVTB0JFTEdJVU0GQlJBWklMCEJVTEdBUklBCENBTUVST1VOBkNBTkFEQQVDSElMRQVDSElOQRBDT1RFIETigJkgSVZPSVJFCENST0FUSUEgBENVQkEGQ1lQUlVTCkNaRUNIIFJFUC4IREVOTUFSSyAIRVJJVFJFQSAIRVRISU9QSUEIRklOTEFORCAHRlJBTkNFIAhHRVJNQU5ZIAVHSEFOQQZHUkVFQ0UJSE9ORyBLT05HCEhVTkdBUlkgBklORElBIAlJTkRPTkVTSUEESVJBTgRJUkFRCElSRUxBTkQgBklUQUxZIAZKQVBBTiAGSk9SREFOBktFTllBIAZLT1JFQSAGS1VXQUlUCExFQkFOT04gBUxJQllBCkxVWEVNQk9VUkcJTUFDRURPTklBCE1BTEFZU0lBBE1BTEkFTUFMVEEGTUVYSUNPBk1PTkFDTwdNT1JPQ0NPCk1PWkFNQklRVUULTkVXIFpFQUxBTkQHTklHRVJJQQdOT1JXQVkgBE9tYW4JUEFLSVNUQU4gC1BISUxJUFBJTkUgBlBPTEFORAlQT1JUVUdBTCAFUUFUQVIHUk9NQU5JQQhSVVNTSUEgIAxTQVVESSBBUkFCSUEHU0VORUdBTBVTRVJCSUEgQU5EIE1PTlRFTkVHUk8JU0lOR0FQT1JFCFNMT1ZBS0lBCFNMT1ZFTklBDVNPVVRIIEFGUklDQSAFU1BBSU4JU1JJIExBTktBBlNVREFOIBFTVUxUQU5BVEUgT0YgT01BTgdTV0VERU4gC1NXSVRaRVJMQU5EBVNZUklBBlRBSVdBTghUQU5aQU5JQQhUSEFJTEFORA9USEUgTkVUSEVSTEFORFMHVFVOSVNJQQdUVVJLRVkgBVUuQS5FA1UuSwZVR0FOREEHVUtSQUlORQNVU0EKVVpCRUtJU1RBTgVZRU1FTghaSU1CQUJXRRVbATMBNAE1ATYCMjABNwIxMQE4ATkCMTACMTICMTQCMTkCMTcCMTYCMjICMTMCMTgCMTUCMjECMjMCMjQCMjUCMjcCMjYCMjgCMzACMjkCMzECMzICMzcCMzQCMzgCMzUCMzMCMzYCNDACMzkCNDMCNDICNDECNDUCNDQCNDYCNTACNTMCNTICNTECNTQCNDkCNDcCNDgCNTUCNTcCNTYCOTQCNjECNjACNTkCNjICNjMCNjQCNjUCNzECNzUCOTACNjYCNzYCNjcCNjgCNzcCNzQCNzgCNjkCNzICNzMCNzACNzkCODICODECNTgCODACODMCODUCODYCODcCODQBMgI4OAI4OQI5MRQrA1tnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZGQCBA9kFgYCAQ9kFgICAg8PFgQeBFRleHQFB1NpZ24gSW4eB1Zpc2libGVnFgIeBXN0eWxlBQ5kaXNwbGF5OmJsb2NrO2QCAw9kFgICAQ8WAh8DaBYCZg9kFgQCAg9kFgICAw8WAh8DaGQCAw8PFgIeCUFjY2Vzc0tleQUBL2RkAgUPZBYCAgEPDxYCHwNoZBYEAgEPDxYCHwNoZGQCAw8PFgIfA2hkFgICAQ8PFgIfA2dkFgQCAQ8PFgIfA2hkFhwCAQ8PFgIfA2hkZAIDDxYCHwNoZAIFDw8WAh8DaGRkAgcPFgIfA2hkAgkPDxYCHwNoZGQCCw8PFgIfA2hkZAINDw8WAh8DaGRkAg8PDxYEHgdFbmFibGVkaB8DaGRkAhEPDxYCHwNoZGQCEw8PFgQfBmgfA2hkZAIVDw8WAh8DaGRkAhcPFgIfA2hkAhkPFgIfA2hkAhsPDxYCHwNnZGQCAw8PFgIfA2dkFgYCAQ8PFgIfA2dkZAIDDw8WAh8DZ2RkAgUPDxYCHwNnZGQCCA9kFgJmDw8WAh4ISW1hZ2VVcmwFF34vSW1hZ2VzL2xhbmdCdG5fYXIucG5nZGQCDg8PFhAeC0Rlc2NyaXB0aW9uZR4JRGlyZWN0aW9uCyoqU3lzdGVtLldlYi5VSS5XZWJDb250cm9scy5Db250ZW50RGlyZWN0aW9uAB4FVGl0bGUFBVBhZ2VzHgpDaHJvbWVUeXBlAgIeBF8hU0ICgIMIHgVXaWR0aBweBkhlaWdodBweC1BhcmFtVmFsdWVzMqEEAAEAAAD/////AQAAAAAAAAAMAgAAAFhNaWNyb3NvZnQuU2hhcmVQb2ludCwgVmVyc2lvbj0xMi4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj03MWU5YmNlMTExZTk0MjljBQEAAAA9TWljcm9zb2Z0LlNoYXJlUG9pbnQuV2ViUGFydFBhZ2VzLlBhcmFtZXRlck5hbWVWYWx1ZUhhc2h0YWJsZQEAAAAFX2NvbGwDHFN5c3RlbS5Db2xsZWN0aW9ucy5IYXNodGFibGUCAAAACQMAAAAEAwAAABxTeXN0ZW0uQ29sbGVjdGlvbnMuSGFzaHRhYmxlBwAAAApMb2FkRmFjdG9yB1ZlcnNpb24IQ29tcGFyZXIQSGFzaENvZGVQcm92aWRlcghIYXNoU2l6ZQRLZXlzBlZhbHVlcwAAAwMABQULCBxTeXN0ZW0uQ29sbGVjdGlvbnMuSUNvbXBhcmVyJFN5c3RlbS5Db2xsZWN0aW9ucy5JSGFzaENvZGVQcm92aWRlcgjsUTg/DgAAAAoKCwAAAAkEAAAACQUAAAAQBAAAAAMAAAAGBgAAAAZVc2VySUQGBwAAAAVUb2RheQYIAAAACExpc3ROYW1lEAUAAAADAAAABgkAAAAPQ3VycmVudFVzZXJOYW1lBgoAAAAUMjAxMi0xMi0xMFQxODozNzo0MVoGCwAAAAVQYWdlcwtkZAIQDw8WEB8IZR8JCysFAB8KBQlTaG9ydGN1dHMfCwICHwwCgIMIHw0cHw4cHw8ywAQAAQAAAP////8BAAAAAAAAAAwCAAAAWE1pY3Jvc29mdC5TaGFyZVBvaW50LCBWZXJzaW9uPTEyLjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTcxZTliY2UxMTFlOTQyOWMFAQAAAD1NaWNyb3NvZnQuU2hhcmVQb2ludC5XZWJQYXJ0UGFnZXMuUGFyYW1ldGVyTmFtZVZhbHVlSGFzaHRhYmxlAQAAAAVfY29sbAMcU3lzdGVtLkNvbGxlY3Rpb25zLkhhc2h0YWJsZQIAAAAJAwAAAAQDAAAAHFN5c3RlbS5Db2xsZWN0aW9ucy5IYXNodGFibGUHAAAACkxvYWRGYWN0b3IHVmVyc2lvbghDb21wYXJlchBIYXNoQ29kZVByb3ZpZGVyCEhhc2hTaXplBEtleXMGVmFsdWVzAAADAwAFBQsIHFN5c3RlbS5Db2xsZWN0aW9ucy5JQ29tcGFyZXIkU3lzdGVtLkNvbGxlY3Rpb25zLklIYXNoQ29kZVByb3ZpZGVyCOxROD8VAAAACgoLAAAACQQAAAAJBQAAABAEAAAABAAAAAYGAAAABlVzZXJJRAYHAAAABldlYlVSTAYIAAAABVRvZGF5BgkAAAAITGlzdE5hbWUQBQAAAAQAAAAGCgAAAA9DdXJyZW50VXNlck5hbWUGCwAAAAkvRW5nbGlzaC8GDAAAABQyMDEyLTEyLTEwVDE4OjM3OjQxWgYNAAAACVNob3J0Y3V0cwtkZAISDw9kFgQeBFBvbGwFBHRydWUeBlN1cnZleQUFZmFsc2VkAhQPZBYCZg8UKwACZA8WAh4GUG9sbElkBSQ0YmY2NGRiMy01YTljLTQ0NmYtOGQyZC0xMjRkMzQzNDUwMzVkFgRmDzwrAAUBBA8WAh4QRW5hYmxlVmFsaWRhdGlvbmdkFgQCAQ9kFgRmD2QWAmYPEGQQFQMJVmVyeSBHb29kBEdvb2QDQmFkFQMBMAExATIUKwMDZ2dnZGQCAQ9kFgICAg8PZBYCHgdvbmNsaWNrBZgCaWYoIVBhZ2VfQ2xpZW50VmFsaWRhdGUoImN0bDAwJFBvbGxWb3RlQW5kSGlzdG9yeVdlYlBhcnQxJGN0bDAxIikpIHJldHVybiBmYWxzZTtMaW5rRGV2LlBvbGxzLlJlc2V0Q2FsbGJhY2soKTtXZWJGb3JtX0RvQ2FsbGJhY2soJ2N0bDAwJFBvbGxWb3RlQW5kSGlzdG9yeVdlYlBhcnQxJGN0bDAwJywiOjI6MToxOjAiLExpbmtEZXYuUG9sbHMuT25DYWxsYmFja0NvbXBsZXRlLCJjdGwwMF9Qb2xsVm90ZUFuZEhpc3RvcnlXZWJQYXJ0MV9jdGwwMCIsbnVsbCxmYWxzZSk7cmV0dXJuIGZhbHNlO2QCAg9kFgQCAQ8PZBYCHxQFxgFMaW5rRGV2LlBvbGxzLlJlc2V0Q2FsbGJhY2soKTtXZWJGb3JtX0RvQ2FsbGJhY2soJ2N0bDAwJFBvbGxWb3RlQW5kSGlzdG9yeVdlYlBhcnQxJGN0bDAwJywiOjE6MjowIixMaW5rRGV2LlBvbGxzLk9uQ2FsbGJhY2tDb21wbGV0ZSwiY3RsMDBfUG9sbFZvdGVBbmRIaXN0b3J5V2ViUGFydDFfY3RsMDAiLG51bGwsZmFsc2UpO3JldHVybiBmYWxzZTtkAgMPD2QWAh8UBe4BaWYoIVBhZ2VfQ2xpZW50VmFsaWRhdGUoKSkgcmV0dXJuIGZhbHNlO0xpbmtEZXYuUG9sbHMuUmVzZXRDYWxsYmFjaygpO1dlYkZvcm1fRG9DYWxsYmFjaygnY3RsMDAkUG9sbFZvdGVBbmRIaXN0b3J5V2ViUGFydDEkY3RsMDAnLCI6MzoyOjAiLExpbmtEZXYuUG9sbHMuT25DYWxsYmFja0NvbXBsZXRlLCJjdGwwMF9Qb2xsVm90ZUFuZEhpc3RvcnlXZWJQYXJ0MV9jdGwwMCIsbnVsbCxmYWxzZSk7cmV0dXJuIGZhbHNlO2QCAg8PZBYCHxQFwgFMaW5rRGV2LlBvbGxzLlJlc2V0Q2FsbGJhY2soKTtXZWJGb3JtX0RvQ2FsbGJhY2soJ2N0bDAwJFBvbGxWb3RlQW5kSGlzdG9yeVdlYlBhcnQxJGN0bDAwJywiOjIiLExpbmtEZXYuUG9sbHMuT25DYWxsYmFja0NvbXBsZXRlLCJjdGwwMF9Qb2xsVm90ZUFuZEhpc3RvcnlXZWJQYXJ0MV9jdGwwMCIsbnVsbCxmYWxzZSk7cmV0dXJuIGZhbHNlO2QCFg8PFhAfCGUfCQsrBQAfCgULU3VydmV5IExpc3QfCwICHwwCgIMIHw0cHw4cHw8yvgQAAQAAAP////8BAAAAAAAAAAwCAAAAWE1pY3Jvc29mdC5TaGFyZVBvaW50LCBWZXJzaW9uPTEyLjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTcxZTliY2UxMTFlOTQyOWMFAQAAAD1NaWNyb3NvZnQuU2hhcmVQb2ludC5XZWJQYXJ0UGFnZXMuUGFyYW1ldGVyTmFtZVZhbHVlSGFzaHRhYmxlAQAAAAVfY29sbAMcU3lzdGVtLkNvbGxlY3Rpb25zLkhhc2h0YWJsZQIAAAAJAwAAAAQDAAAAHFN5c3RlbS5Db2xsZWN0aW9ucy5IYXNodGFibGUHAAAACkxvYWRGYWN0b3IHVmVyc2lvbghDb21wYXJlchBIYXNoQ29kZVByb3ZpZGVyCEhhc2hTaXplBEtleXMGVmFsdWVzAAADAwAFBQsIHFN5c3RlbS5Db2xsZWN0aW9ucy5JQ29tcGFyZXIkU3lzdGVtLkNvbGxlY3Rpb25zLklIYXNoQ29kZVByb3ZpZGVyCOxROD8OAAAACgoLAAAACQQAAAAJBQAAABAEAAAAAwAAAAYGAAAABlVzZXJJRAYHAAAABkxpc3RJRAYIAAAABVRvZGF5EAUAAAADAAAABgkAAAAPQ3VycmVudFVzZXJOYW1lBgoAAAAkNUZFRDY5OEItQkVEOS00MEM0LTlEQTItNTU5MkVFMzYxRkI1BgsAAAAUMjAxMi0xMi0xMFQxODozNzo0MVoLZGQCGA9kFhICAQ8WAh8ACysEAWQCAw9kFgJmDw8WAh8DaGRkAgUPZBYCZg8PFgIfA2hkZAIHD2QWAmYPDxYCHwNoZGQCCQ9kFgJmDw8WAh8DaGRkAgsPZBYCZg8PFgIfA2hkZAIND2QWAmYPDxYCHwNoZGQCDw9kFgJmDw8WAh8DaGRkAhEPZBYCZg8PFgIfA2hkZAIaD2QWAmYPFgIfAgWCGjx0YWJsZSB3aWR0aD0nMTAwJScgY2VsbHBhZGluZz0nMCcgY2VsbHNwYWNpbmc9JzAnPjx0cj48dGQgdmFsaWduPSd0b3AnPjxkaXYgY2xhc3M9J3NwYW4tMic+PHNwYW4gY2xhc3M9J3NlbGVjdGVkIHNwYW5Ib21lJyBzdHlsZT0nZGlzcGxheTpub25lJz5Ib21lPC9zcGFuPiA8YSBocmVmPSAiIC9FbmdsaXNoLyIgY2xhc3M9J2xua0hvbWUnPkhvbWU8L2E+PC9kaXY+PC90ZD48dGQgdmFsaWduPSd0b3AnPjxkaXYgY2xhc3M9J3NwYW4tNCBwcmVwZW5kLTEgbGFzdCc+PGEgaHJlZj0iL0VuZ2xpc2gvUGFnZXMvQ29udGFjdEJEQy5hc3B4Ij5XaGVyZSB0byBmaW5kIHVzIDwvYT48dWw+PGxpPjxhIGhyZWY9Ii9FbmdsaXNoL1BhZ2VzL1dvcmtpbmdIb3Vycy5hc3B4Ij5Xb3JraW5nIEhvdXJzIDwvYT48L2xpPjxsaT48YSBocmVmPSIvRW5nbGlzaC9QYWdlcy9Mb2NhdG9yLmFzcHgiPkJEQyBMb2NhdG9yPC9hPjwvbGk+PC91bD48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9QYWdlcy9SZXRhaWxfb2xkLmFzcHgiPlJldGFpbCBCYW5raW5nPC9hPjx1bD48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvTGluZW9mQnVzaW5lc3MvUmV0YWlsL1BhZ2VzL0FjY291bnRzLmFzcHgiPkFjY291bnRzPC9hPjwvbGk+PGxpPjxhIGhyZWY9Ii9FbmdsaXNoL0xpbmVvZkJ1c2luZXNzL1JldGFpbC9QYWdlcy9EZXBvc2l0LmFzcHgiPlRlcm0gRGVwb3NpdHM8L2E+PC9saT48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvTGluZW9mQnVzaW5lc3MvUmV0YWlsL1BhZ2VzL0NlcnRpZmljYXRlc09mRGVwb3NpdC5hc3B4Ij5DZXJ0aWZpY2F0ZXMgT2YgRGVwb3NpdDwvYT48L2xpPjxsaT48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9SZXRhaWwvUGFnZXMvUmV0YWlsTG9hbnMuYXNweCI+UmV0YWlsIExvYW5zPC9hPjwvbGk+PGxpPjxhIGhyZWY9Ii9FbmdsaXNoL0xpbmVvZkJ1c2luZXNzL1JldGFpbC9QYWdlcy9DYXJkcy5hc3B4Ij5DYXJkczwvYT48L2xpPjxsaT48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9SZXRhaWwvUGFnZXMvaW5zdXJhbmNlLmFzcHgiPkJhbmNhc3N1cmFuY2U8L2E+PC9saT48L3VsPjwvZGl2PjxkaXYgY2xhc3M9J3NwYW4tNCBwcmVwZW5kLTEgbGFzdCc+PGEgaHJlZj0iL0VuZ2xpc2gvTGluZW9mQnVzaW5lc3MvUGFnZXMvSW52ZXN0bWVudF9vbGQuYXNweCI+SW52ZXN0bWVudDE8L2E+PHVsPjxsaT48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9JbnZlc3RtZW50L1BhZ2VzL0N1bXVsYXRpdmVGdW5kLmFzcHgiPkN1bXVsYXRpdmUgRnVuZDwvYT48L2xpPjxsaT48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9JbnZlc3RtZW50L1BhZ2VzL0NhaXJvVG9kYXkuYXNweCI+Q2Fpcm8gVG9kYXk8L2E+PC9saT48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvTGluZW9mQnVzaW5lc3MvSW52ZXN0bWVudC9QYWdlcy9BbFdlZmFxLmFzcHgiPkFsIFdlZmFxIElzbGFtaWMgRnVuZDwvYT48L2xpPjwvdWw+PGEgaHJlZj0iL0VuZ2xpc2gvTWFya2V0VXBkYXRlcy9QYWdlcy9NYXJrZXRTdGF0aXN0aWNzLmFzcHgiPk1hcmtldFVwZGF0ZXM8L2E+PHVsPjxsaT48YSBocmVmPSIvRW5nbGlzaC9NYXJrZXRVcGRhdGVzL1BhZ2VzL0N1cnJlbmN5RXhjaGFuZ2UuYXNweCI+Q3VycmVuY3kgRXhjaGFuZ2UgUmF0ZXM8L2E+PC9saT48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvTWFya2V0VXBkYXRlcy9QYWdlcy9NYXJrZXRTdGF0aXN0aWNzLmFzcHgiPlN0b2NrIE1hcmtldCBpbmRpY2VzIHBlcmZvcm1hbmNlIDwvYT48L2xpPjwvdWw+PGEgaHJlZj0iL0VuZ2xpc2gvTmV3cy9QYWdlcy9OZXdzbGV0dGVyTGlzdGluZy5hc3B4Ij5OZXdzbGV0dGVyPC9hPjx1bD48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvUGFnZXMvU3Vic2NyaWJlLmFzcHgiPlN1YnNjcmliZTwvYT48L2xpPjxsaT48YSBocmVmPSIvRW5nbGlzaC9QYWdlcy9VbnN1YnNjcmliZS5hc3B4Ij5VbnN1YnNjcmliZTwvYT48L2xpPjwvdWw+PC9kaXY+PGRpdiBjbGFzcz0nc3Bhbi00IHByZXBlbmQtMSBsYXN0Jz48YSBocmVmPSIvRW5nbGlzaC9OZXdzL1BhZ2VzL05ld3NtYWluLmFzcHgiPkJEQyBOZXdzPC9hPjx1bD48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvTmV3cy9QYWdlcy9OZXdzTGlzdGluZy5hc3B4Ij5CREMgTmV3czwvYT48L2xpPjxsaT48YSBocmVmPSIvRW5nbGlzaC9Qcm9tb3Rpb25zL1BhZ2VzL1Byb21vdGlvbnNMaXN0aW5nLmFzcHgiPlNwZWNpYWwgUHJvbW90aW9uczwvYT48L2xpPjwvdWw+PGEgaHJlZj0iL0VuZ2xpc2gvUmVwb3J0cy9QYWdlcy9Bbm51YWxSZXBvcnRzLmFzcHgiPlJlcG9ydHM8L2E+PHVsPjxsaT48YSBocmVmPSIvRW5nbGlzaC9SZXBvcnRzL1BhZ2VzL0FubnVhbFJlcG9ydHMuYXNweCI+QW5udWFsIFJlcG9ydHM8L2E+PC9saT48bGk+PGEgaHJlZj0iL0VuZ2xpc2gvUmVwb3J0cy9QYWdlcy9GaW5hbmNpYWxSZXBvcnRzLmFzcHgiPkZpbmFuY2lhbCBSZXBvcnRzPC9hPjwvbGk+PC91bD48L2Rpdj48L3RkPjx0ZCB2YWxpZ249J3RvcCc+PGRpdiBjbGFzcz0nc3Bhbi00IHByZXBlbmQtMSBsYXN0Jz48YSBocmVmPSIvRW5nbGlzaC9QYWdlcy9DdXN0b21lclNlcnZpY2VzLmFzcHgiPkN1c3RvbWVyIFNlcnZpY2UgPC9hPjxicj48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9QYWdlcy9Db3Jwb3JhdGUuYXNweCI+Q29ycG9yYXRlIEJhbmtpbmc8L2E+PGJyPjxhIGhyZWY9Ii9FbmdsaXNoL0xpbmVvZkJ1c2luZXNzL1BhZ2VzL1NNRV9vbGQuYXNweCI+RW50ZXJwcmlzZSBCYW5raW5nPC9hPjxicj48YSBocmVmPSIvRW5nbGlzaC9MaW5lb2ZCdXNpbmVzcy9QYWdlcy9UcmVhc3VyeV9vbGQuYXNweCI+VHJlYXN1cnk8L2E+PGJyPjxhIGhyZWY9Ii9FbmdsaXNoL1BhZ2VzL0FwcGxpY2F0aW9ucy5hc3B4Ij5Gb3JtcyBhbmQgQXBwbGljYXRpb25zPC9hPjxicj48YSBocmVmPSIvRW5nbGlzaC9QYWdlcy9Db250YWN0VXMuYXNweCI+Q29udGFjdCBVczwvYT48YnI+PGEgaHJlZj0iL0VuZ2xpc2gvUGFnZXMvRmVlZGJhY2suYXNweCI+RmVlZGJhY2sgPC9hPjxicj48YSBocmVmPSIvRW5nbGlzaC9QYWdlcy9Vc2VmdWxMaW5rcy5hc3B4Ij5Vc2VmdWwgTGlua3M8L2E+PGJyPjxhIGhyZWY9Ii9FbmdsaXNoL1BhZ2VzL0NyZWF0ZUFjY291bnQuYXNweCI+QWNjb3VudCBPcGVuaW5nPC9hPjxicj48YSBocmVmPSIvRW5nbGlzaC9QYWdlcy9DYWxjdWxhdG9ycy5hc3B4Ij5DYWxjdWxhdG9yczwvYT48YnI+PGEgaHJlZj0iL0VuZ2xpc2gvUGFnZXMvUmVhZCBtb3JlLmFzcHgiPkltcG9ydGFudCBBbm5vdW5jZW1lbnQ8L2E+PGJyPjwvZGl2PjwvdGQ+PC90cj48L3RhYmxlPmQYAQUeX19Db250cm9sc1JlcXVpcmVQb3N0QmFja0tleV9fFgEFG2N0bDAwJExhbmd1YWdlJEltYWdlQnV0dG9uMQNqfMQkDpy/SZj1yMyPb0Y7X2eQ',
        '__ASYNCPOST':'true'})
    
    root = lxml.html.fromstring(html)
    areas = root.xpath("//select[@name='ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlArea']/option")
    print areas
    if areas != []:
        result = []
        for i in areas:
            result.append({'id': i.attrib['value'], 'name': i.text_content()})
        return result
    else:
        return []

def get_branches(area_id):
    
    payload = '{"loctype":"1,2", "area": ' + area_id +'}'
    headers = {'Content-Type': 'application/json', 
'X-AjaxPro-Method': 'AJAXSearchByArea',
'Referer': 'http://www.bdc.com.eg/English/Pages/Locator.aspx',
'Accept-Encoding': 'gzip,deflate,sdch'}

    r = requests.post('http://www.bdc.com.eg/ajaxpro/BDC.UserControls.Locator,BDC.ashx', data=payload, headers=headers)

    text= re.findall(r'Ajax\.Web\.DataTable\(.*?\]\]\,\[\[(.+?)\]\]\)', r.text, re.I|re.U)
    #print text
    try:
        _json = demjson.decode('[[' + text[0] + ']]')
        result = []
        for j in _json:
            result.append({'name': j[0], 'name_original':j[1], 'address': j[7], 'address_original': j[8], 'lat':j[10] , 'lng':j[11], 'other': j[14]})
            
        return result
    except:
        return []



#scraperwiki.sqlite.execute('delete from data')
html = scraperwiki.scrape("http://www.bdc.com.eg/English/Pages/Locator.aspx")
root = lxml.html.document_fromstring(html);

cities = root.xpath("//select[@name='ctl00$ctl11$g_e72a87a7_1855_4f5b_8d58_8e780120c898$ctl00$ddlCity']/option")
i=1
for c in cities:
    #print c.attrib['value'], c.text_content()

    areas = get_areas(c.attrib['value'])
    #print areas
    for a in areas:
        branches = get_branches(a['id'])
        #print branches
        for b in branches:
            scraperwiki.sqlite.save(unique_keys=['id'], data={'id':i, 'city': c.text_content(), 'area': a['name'], 
                'branch_name': b['name'], 
                'branch_name_original': b['name_original'],
                'address': b['address'],
                'address_original': b['address_original'],
                'lat': b['lat'],
                'lng': b['lng'],
                'other': b['other']}, table_name='data_copy')
            i+=1

    

